(function(C){jQuery.extend({ht_getcookie:function(W){var k=document.cookie.indexOf(W);var i=document.cookie.indexOf(";",k);return k==-1?"":unescape(document.cookie.substring(k+W.length+1,(i>k?i:document.cookie.length)))},ht_setcookie:function(aa,Z,Y,X,k,W){var i=new Date();i.setTime(i.getTime()+Y*1000);document.cookie=escape(aa)+"="+escape(Z)+(i?"; expires="+i.toGMTString():"")+(X?"; path="+X:"; path=/")+(k?"; domain="+k:"")+(W?"; secure":"")},textFocus:function(W){var k,i,W=W===undefined?0:parseInt(W);this.each(function(){if(!this.setSelectionRange){k=this.createTextRange();W===0?k.collapse(false):k.move("character",W);k.select()}else{i=this.value.length;W===0?this.setSelectionRange(i,i):this.setSelectionRange(W,W)}this.focus()});return this}});var w=[];var D=[];var E=[];var G=[];var v=0;var y=0;var A=0;var S=0;var U=false;var g=false;var H=false;var z=0;var I=null;var m=-1;var N={};var f=[];var e=[];var d=[];var b=[];var V=[];var F=new Array("a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");var j=[];var x=false;var c=[];for(var R=0;R<26;R++){c[R]=[]}var P=[];for(var T=0;T<5;T++){P[T]=[]}var t=[];var s=[];var q=[];var p=[];var o=[];var K=[];var a=false;var L=true;var u=12;var h="简码/汉字";var n="简码/汉字";var r="inp-txt_select";var l="inp-txt";var B=false;var J=null;var Q=null;var M=false;var O=C.ht_getcookie("hj_favcity");C.stationFor12306={bindInputs:[],get_initInputValue:function(){return h},get_initTopInputValue:function(){return n},city_Bind:function(k){if(k.length==0){return}var i="";C.each(k,function(W){if(O==k[W][2]){i+="<div class='cityline' id='citem_"+W+"' cturn='"+k[W][6]+"'><span class='ralign'><b>"+k[W][1]+"</b></span></div>\n"}else{i+="<div class='cityline' id='citem_"+W+"' cturn='"+k[W][6]+"'><span class='ralign'>"+k[W][1]+"</span><span style='float:right;' class='ralign'>"+k[W][3]+"</span></div>\n"}});C("#panel_cities").html(i);C(".cityline").mouseover(function(){C.stationFor12306.city_shiftSelect(this)}).click(function(){C.stationFor12306.city_confirmSelect();E=C.stationFor12306.filterCity("");C.stationFor12306.city_showlist(0)});C.stationFor12306.city_shiftSelect(C("#citem_0"))},city_changeSelectIndex:function(i){var k=A+i;if(k==-1){C.stationFor12306.city_showlist(z-1);C.stationFor12306.city_shiftSelect(C("#citem_"+(G.length-1)))}else{if(k==G.length){C.stationFor12306.city_showlist(z+1);C.stationFor12306.city_shiftSelect(C("#citem_0"))}else{C.stationFor12306.city_shiftSelect(C("#citem_"+k))}}},city_confirmSelect:function(){I.val(S[1]);curObjCode.val(S[2]);if(B){C.stationFor12306.setStationInCookies(S[1],S[2])}C("#form_cities").css("display","none");C("#form_cities2").css("display","none");C("#form_cities3").css("display","none");m=-1;y=0;C.stationFor12306.setStationStyle();if(L){C.stationFor12306.LoadJS(S[2])}if(J){J(I,curObjCode)}},city_shiftSelect:function(k){if(v!=k){if(v!=0){C(v).removeClass("citylineover").addClass("cityline").css("backgroundColor","white")}if(k!=0){try{v=k;var i=C(v).removeClass("cityline").addClass("citylineover").css("backgroundColor","#c8e3fc");A=Number(i.attr("id").split("_")[1]);S=w[Number(i.attr("cturn"))];C("#cityid").val(S[2])}catch(W){}}}},city_shiftSelectInLi:function(i){if(y!=i){if(y!=0){C(y).removeClass("ac_over").addClass("ac_odd")}if(i!=0){try{y=i;C(y).removeClass("ac_odd").addClass("ac_over")}catch(k){}}}},js:function(W){var k;for(k=1;k<=7;k++){if(C("#nav_list"+k).attr("class")){C("#ul_list"+k).css("display","none");C("#nav_list"+k).removeClass("action")}}for(k=1;k<=7;k++){if(k==W){C("#ul_list"+k).css("display","block");C("#nav_list"+k).addClass("action");if(k==1||k==7){C("#flip_cities2").css("display","none")}if(k>1&&k<7){var Y=C.stationFor12306.tHtmlGetCityName(W-1,-1,0);if(Y>u){var X=Math.ceil(Y/u);if(X>1){C.stationFor12306.pageDesigh(X,0,k)}C("#flip_cities2").css("display","block")}else{C("#flip_cities2").css("display","none")}}else{I.focus()}}else{C("#ul_list"+k).css("display","none");C("#nav_list"+k).removeClass("action")}}if(1!=W){C(".ac_even").on("mouseover",function(){C.stationFor12306.city_shiftSelectInLi(this)}).on("click",function(){I.val(C(this).text());curObjCode.val(C(this).attr("data"));if(B){C.stationFor12306.setStationInCookies(C(this).text(),C(this).attr("data"))}C("#form_cities2").css("display","none");m=-1;y=0;C.stationFor12306.setStationStyle();if(L){C.stationFor12306.LoadJS(C(this).attr("data"))}if(J){J(I,curObjCode)}})}},tHtmlGetCityName:function(k,i,X){switch(k){case 0:if(i==-1){return D.length}if(i==-2){return D}return D[i];break;case 1:if(i==-1){return c[3].length}if(i==-2){return f}if(f.length>u){var W=Math.ceil((f.length)/u);if(W>1){t=f.slice(u*(X),Math.min(u*(X+1),f.length));return t[i]}}return f[i];break;case 2:if(i==-1){return c[7].length}if(i==-2){return e}if(e.length>u){var W=Math.ceil((e.length)/u);if(W>1){s=e.slice(u*(X),Math.min(u*(X+1),e.length));return s[i]}}return e[i];break;case 3:if(i==-1){return c[11].length}if(i==-2){return d}if(d.length>u){var W=Math.ceil((d.length)/u);if(W>1){q=d.slice(u*(X),Math.min(u*(X+1),d.length));return q[i]}}return d[i];break;case 4:if(i==-1){return c[18].length}if(i==-2){return b}if(b.length>u){var W=Math.ceil((b.length)/u);if(W>1){p=b.slice(u*(X),Math.min(u*(X+1),b.length));return p[i]}}return b[i];break;case 5:if(i==-1){return c[24].length}if(i==-2){return V}if(V.length>u){var W=Math.ceil((V.length)/u);if(W>1){o=V.slice(u*(X),Math.min(u*(X+1),V.length));return o[i]}}return V[i];break;default:return"error";break}},closeShowCity:function(){C("#form_cities2").css("display","none");m=-1;y=0;C.each(C.stationFor12306.bindInputs,function(Y,X){var W="#"+X;var k="#"+X+"Text";var i=C(k).val();if(""==i){C(k).val(h);C.stationFor12306.from_to_station_class_gray(C(k));C(W).val("")}})},showAllCity:function(){var ab="";var k="440px";if(B){k="400px"}ab='<div class="com_hotresults" id="thetable" style="width:'+k+'"><div style="width:100%;"><div class="ac_title"><span>拼音支持首字母输入</span><a class="ac_close" style="cursor:pointer" title="关闭" onclick="$.stationFor12306.closeShowCity()"></a></div><ul class="AbcSearch clx" id="abc">';if(B){ab=ab+'<li class="action" index="7" method="liHotTab"  onclick="$.stationFor12306.js(7)" id="nav_list7">常用</li>'}ab=ab+'<li index="1" method="liHotTab"  onclick="$.stationFor12306.js(1)" id="nav_list1">热门</li><li index="2" method="liHotTab"  onclick="$.stationFor12306.js(2)" id="nav_list2">ABCDE</li><li index="3" method="liHotTab"  onclick="$.stationFor12306.js(3)" id="nav_list3">FGHIJ</li><li index="4" method="liHotTab"  onclick="$.stationFor12306.js(4)" id="nav_list4">KLMNO</li><li index="5" method="liHotTab"  onclick="$.stationFor12306.js(5)" id="nav_list5">PQRST</li><li index="6" method="liHotTab"  onclick="$.stationFor12306.js(6)" id="nav_list6">UVWXYZ</li></ul>';if(B){ab+='<ul class="popcitylist" style="overflow: auto;max-height: 280px;height: 191px;" method="hotData" id="ul_list7">';var ac=C.stationFor12306.getStationInCookies();var Y=ac.length;if(Y>2){M=true;for(var ad=0;ad<Y;ad++){ab+='<li class="ac_even"   title="'+ac[ad][0]+'" data="'+ac[ad][1]+'">'+ac[ad][0]+"</li>"}}ab+="</ul>"}ab+='<ul class="popcitylist" style="overflow: auto;max-height: 280px;height: 191px;display:none;" method="hotData" id="ul_list1">';var X=C.stationFor12306.tHtmlGetCityName(0,-1,0);var aa="";if(!B){aa=" openLi"}for(var ad=0;ad<X;ad++){ab+='<li class="ac_even'+aa+'"   title="'+C.stationFor12306.tHtmlGetCityName(0,ad,0)[1]+'" data="'+C.stationFor12306.tHtmlGetCityName(0,ad,0)[2]+'">'+C.stationFor12306.tHtmlGetCityName(0,ad,0)[1]+"</li>"}ab+="</ul>";for(var ae=2;ae<=6;ae++){var Z=ae-1;var i=C.stationFor12306.tHtmlGetCityName(Z,-1,0);if(i>u){var W=Math.ceil((i)/u);if(W>1){ab+='<div id="ul_list'+ae+'">';C.stationFor12306.pageDesigh(W,0,ae)}C("#flip_cities2").css("display","block")}else{ab+='<ul  class="popcitylist" style="overflow: auto; max-height: 260px; height: 191px;display:none;" id="ul_list'+ae+'">';C("#flip_cities2").css("display","none");var aa="";if(!B){aa=" openLi"}for(var ad=0;ad<C.stationFor12306.tHtmlGetCityName(Z,-1,0);ad++){ab+='<li class="ac_even'+aa+'"   title="'+C.stationFor12306.tHtmlGetCityName(Z,ad,0)[1]+'" data="'+C.stationFor12306.tHtmlGetCityName(Z,ad,0)[2]+'">'+C.stationFor12306.tHtmlGetCityName(Z,ad,0)[1]+"</li>"}}ab+="</div>"}ab+='<div id="flip_cities2"> 翻页控制区</div>';ab+="</div>";C("#panel_cities2").html(ab);C("#thetable").on("click",function(){if(C("#form_cities2").css("display")=="block"){if(m==1|m==0){m==-1}I.select()}});C("#form_cities").on("click",function(){if(C("#form_cities").css("display")=="block"){if(m==1|m==0){m==-1}I.select()}});C(".ac_even").on("mouseover",function(){C.stationFor12306.city_shiftSelectInLi(this)}).on("click",function(){I.val(C(this).text());curObjCode.val(C(this).attr("data"));if(B){C.stationFor12306.setStationInCookies(C(this).text(),C(this).attr("data"))}C("#form_cities2").css("display","none");m=-1;y=0;C.stationFor12306.setStationStyle();if(L){C.stationFor12306.LoadJS(C(this).attr("data"))}if(J){J(I,curObjCode)}});C("#flip_cities2").css("display","none");return w},LoadJS:function(W){if(((typeof(mm_addjs)!="undefined"))&&(""!=mm_addjs)&&(mm_addjs==1)){var k=document.getElementsByTagName("HEAD").item(0);var i=document.createElement("SCRIPT");i.src=mm_srcjs+W+".js";i.type="text/javascript";k.appendChild(i)}},addZMHtml:function(X,Y){var W="";if(X&&X.length>0){var Z=X[0][0].charAt(0);W+='<ul  class="popcitylist" style="overflow: auto; max-height: 260px; " >';W+='<li class="ac_letter">'+Z.toUpperCase()+"</li>";for(var i=0;i<12;i++){var k=X[i];if(k){W+='<li class="ac_even'+Y+'"   title="'+k[1]+'" data="'+k[2]+'">'+k[1]+"</li>"}else{W+='<li class="ac_even'+Y+'" </li>'}}W+="</ul>"}return W},pageDesigh:function(Z,ac,ad){var W="";if(Z>1){if(ac==-1){ac=(Z-1)}else{if(ac==Z){ac=0}}var ab="";if(!B){ab=" openLi"}for(var X=2;X<=6;X++){if(X==ad){var aa=P[X-2];for(var i=0;i<aa.length;i++){K=aa[i].slice(ac*u,(ac+1)*u);W+=C.stationFor12306.addZMHtml(K,ab)}}}C("#ul_list"+ad).html(W);C("#ul_list"+ad).css("height",270);if(W){var Y=(ac==0)?"&laquo;&nbsp;上一页":"<a style='cursor:pointer'    class='cityflip' onclick='$.stationFor12306.pageDesigh("+Z+","+(ac-1)+","+ad+");return false;'>&laquo;&nbsp;上一页</a>";Y+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;";Y+=(ac==Z-1)?"下一页&nbsp;&raquo;":"<a style='cursor:pointer' class='cityflip'  onclick='$.stationFor12306.pageDesigh("+Z+","+(ac+1)+","+ad+")'>下一页&nbsp;&raquo;</a>";C("#flip_cities2").html(Y)}else{C("#flip_cities2").html("")}if(m==1|m==0|m==2){m==-1}if(I){I.select()}}else{}C(".ac_even").on("mouseover",function(){C.stationFor12306.city_shiftSelectInLi(this)}).on("click",function(){I.val(C(this).text());curObjCode.val(C(this).attr("data"));if(B){C.stationFor12306.setStationInCookies(C(this).text(),C(this).attr("data"))}C("#form_cities2").css("display","none");m=-1;y=0;C.stationFor12306.setStationStyle();if(L){C.stationFor12306.LoadJS(C(this).attr("data"))}if(J){J(I,curObjCode)}})},filterCity:function(Z){if(Z.length==0){C("#top_cities").html(n);return w}var Y=/<\/?[^>]*>/g;Z=Z.replace(Y,"");var W=[];var k=/[^A-z]/.test(Z);for(var X=0;X<w.length;X++){if(C.stationFor12306.isMatchCity(w[X],Z,k)){W.push(w[X])}}if(W.length>0){C("#top_cities").html('按"<font color=red>'+Z+'</font>"检索：');return W}else{C("#top_cities").html("无法匹配:<font color=red>"+Z+"</font>");return[]}},replaceChar:function(i,W,k){return i.substr(0,W)+k+i.substr(W+1,i.length-1)},isMatchCity:function(Z,ac,W){var ac=ac.toLowerCase();var k=[Z[4].toLowerCase(),Z[1],Z[3].toLowerCase()];var ab=-1;var Y=-1;if(W){ac=ac.split("");for(var X=0;X<ac.length;X++){var ae=k[1].indexOf(ac[X]);if(ae>ab&&ae<=X){k[1]=C.stationFor12306.replaceChar(k[1],ae,"-");ab=ae}else{return false}}}else{ac=ac.split("");var i=true;var aa=true;for(var X=0;X<ac.length;X++){var ae=k[0].indexOf(ac[X]);if(ae>ab&&ae<=X){k[0]=C.stationFor12306.replaceChar(k[0],ae,"-");ab=ae}else{i=false;break}}for(var X=0;X<ac.length;X++){var ad=k[2].indexOf(ac[X]);if(ad>Y&&ad<=X){k[2]=C.stationFor12306.replaceChar(k[2],ad,"-");Y=ad}else{aa=false;break}}if((i==false)&&(aa==false)){return false}}return true},city_showlist_page:function(ad,Y){var Z="";Z+='<div class="citypage">';Z+=(ad==0)?"":'<a href="#" class="pagetxt" onclick="$.stationFor12306.city_showlist('+(ad-1)+');return false;"><<</a>';var ae=ad+1;var aa=Y;var ab=2;var ac=5;var k=(ae-ab)>0?(ae+ab>aa?aa-ac+1:ae-ab):1;var W=k+ac>aa?aa+1:k+ac;if(aa<ac){for(var X=1;X<aa+1;X++){if(ae==X){Z+="<a href='' class='cur' onclick='$.stationFor12306.city_showlist("+(X-1)+");return false;'>"+(X)+"</a>"}else{Z+="<a href='' onclick='$.stationFor12306.city_showlist("+(X-1)+");return false;'>"+(X)+"</a>"}}}else{for(var X=k;X<W;X++){if(ae==X){Z+="<a href='' class='cur' onclick='$.stationFor12306.city_showlist("+(X-1)+");return false;'>"+(X)+"</a>"}else{Z+="<a href='' onclick='$.stationFor12306.city_showlist("+(X-1)+");return false;'>"+(X)+"</a>"}}}Z+=(ad==Y-1)?"":'<a href="" class="pagetxt" onclick="$.stationFor12306.city_showlist('+(ad+1)+');return false;">>></a>';Z+="</div>";return Z},city_showlist:function(W){if(E.length>6){var k=Math.ceil((E.length)/6);if(W==-1){W=(k-1)}else{if(W==k){W=0}}G=E.slice(6*(W),Math.min(6*(W+1),E.length));C.stationFor12306.city_Bind(G);var i="";i+=C.stationFor12306.city_showlist_page(W,k);C("#flip_cities").html(i);C("#flip_cities").css("display","block")}else{W=0;G=E;C.stationFor12306.city_Bind(G);C("#flip_cities").css("display","none")}z=W;if(C("#form_cities").css("display")=="block"){a=true;I.focus()}},fixDivBugInIE6:function(i){try{i.bgiframe();if(i.width()>C("> ul",i).width()){i.css("overflow","hidden")}else{C("> iframe.bgiframe",i).width(C("> ul",i).width());i.css("overflow","scroll")}if(i.height()>C("> ul",i).height()){i.css("overflow","hidden")}else{C("> iframe.bgiframe",i).height(C("> ul",i).height());i.css("overflow","scroll")}}catch(k){}},clearStation:function(i){m=-1;var W=I.val();var X=curObjCode.val();if(W==""||X==""){I.val("");curObjCode.val("")}else{var k=W+"|"+X;if(typeof(station_names)!="undefined"){if(station_names.indexOf(k)==-1){I.val("");curObjCode.val("")}else{if("click"==i){I.select();if(C("#form_cities").is(":hidden")){C("#form_cities2").css("display","block")}}}}else{I.val("");curObjCode.val("")}}},MapCityID:function(W){for(var k=0;k<w.length;k++){if(w[k][1]==W){return w[k][2]}}return 0},MapCityName:function(k){for(var W=0;W<w.length;W++){if(w[W][2]==k){return w[W][1]}}return""},SetISPos:function(Y){if(Q){Q(C("#form_cities"),C("#form_cities2"))}else{C("#form_cities").css("left",Y.position().left);C("#form_cities").css("top",Y.position().top+Y.height()+12);C("#form_cities2").css("left",Y.position().left);C("#form_cities2").css("top",Y.position().top+Y.height()+12)}var X=Y.offset().top;var i=C("#search_div");var k=C("#choice_div");i.css("top",X);k.css("top",X);var W=Y.offset().left;i.css("left",W);k.css("left",W)},myHandlerFg:function(i){if(i==null){i.keyCode=9}else{if(!i.which&&i.which==13){i.preventDefault()}else{if(i.which&&i.keyCode==13){i.which=9}}}},myHandler2:function(i){if(i==null){i=window.event;i.returnValue=false}else{if(i.which&&i.which==13){var W=document.getElementById("Upload_Data3");if(document.createEvent){var k=document.createEvent("MouseEvents");k.initEvent("click",true,false);W.dispatchEvent(k)}else{if(document.createEventObject){W.fireEvent("onclick")}}}else{if(!i.which&&i.which==13){i.preventDefault()}}}},from_to_station_class_plain:function(i){if(l&&l!=""){i.removeClass(l)}if(r&&r!=""){i.addClass(r)}},from_to_station_class_gray:function(i){if(r&&r!=""){i.removeClass(r)}if(l&&l!=""){i.addClass(l)}},setStationStyle:function(){var i=I.val();if(i==""){I.val(h);C.stationFor12306.from_to_station_class_gray(I);curObjCode.val("")}else{C.stationFor12306.from_to_station_class_plain(I)}},setCurValue:function(){I.val(S[1]);curObjCode.val(S[2])},bindEvent:function(i){var W="#"+i;var k="#"+i+"Text";C(k).keydown(function(Y){I=C(k);curObjCode=C(W);m=0;a=true;L=true;C("#form_cities2").css("display","none");y=0;var X=C(k).width();if(-[1,]){X=X-4}X=X<220?220:X;C("#form_cities").css("width",X);C("#form_cities").css("display","block");C(".AbcSearch li").removeClass("action");C(".popcitylist").css("display","none");if(M&&B){C("#ul_list7").css("display","block");C("#nav_list7").addClass("action")}else{C("#nav_list1").addClass("action");C("#ul_list1").css("display","block")}C("#flip_cities2").css("display","none");C(".ac_even").removeClass("ac_over").addClass("ac_odd");Y=Y||window.event;if(Y.keyCode==40){C.stationFor12306.city_changeSelectIndex(1);C("#form_cities").css("display","block");C.stationFor12306.SetISPos(I);C.stationFor12306.setCurValue()}else{if(Y.keyCode==38){C.stationFor12306.city_changeSelectIndex(-1);C.stationFor12306.setCurValue();C("#form_cities").css("display","block");C.stationFor12306.SetISPos(I)}else{if(Y.keyCode==13){C.stationFor12306.city_confirmSelect();if(document.addEventListener){document.addEventListener("keypress",C.stationFor12306.myHandlerFg,true)}else{evt=window.event;evt.keyCode=9}}}}}).focus(function(){L=true;if(a){C("#form_cities2").css("display","none");y=0;a=false;m=-1}else{if(m==-1){C(".AbcSearch li").removeClass("action");C(".popcitylist").css("display","none");C("#flip_cities2").css("display","none");if(M&&B){C("#ul_list7").css("display","block");C("#nav_list7").addClass("action")}else{C("#nav_list1").addClass("action");C("#ul_list1").css("display","block")}C(".ac_even").removeClass("ac_over").addClass("ac_odd");C("#form_cities2").css("display","block");for(var X=2;X<=6;X++){C("#ul_list"+X).css("height",0)}}}I=C(k);curObjCode=C(W);m=0;U=true;C.stationFor12306.SetISPos(I)}).blur(function(){I=C(k);curObjCode=C(W);m=0;a=false;L=true;if(!g&&!H){C.stationFor12306.clearStation("blur");U=false;C("#form_cities").css("display","none");C("#form_cities2").css("display","none");m=-1;y=0;E=C.stationFor12306.filterCity("");C.stationFor12306.city_showlist(0);C.stationFor12306.setStationStyle()}}).keyup(function(X){I=C(k);curObjCode=C(W);m=0;a=true;X=X||window.event;if(X.keyCode!=40&&X.keyCode!=38&&X.keyCode!=37&&X.keyCode!=39&&X.keyCode!=13&&X.keyCode!=9){E=C.stationFor12306.filterCity(I.val());C.stationFor12306.city_showlist(0)}}).click(function(){C.stationFor12306.clearStation("click")});C.stationFor12306.bindInputs.push(i)},getStationInCookies:function(){var W=[];var k=C.ht_getcookie("_city_name_save_station");if(k){var i=k.split(",");if(i&&i.length>0){C.each(i,function(aa,Z){var X=Z.split("#");var Y=[];Y[0]=X[0];Y[1]=X[1];W[aa]=Y})}}return W},setStationInCookies:function(af,W){var ac=C.stationFor12306.getStationInCookies();var Z=[];var ag=ac.length;var Y=true;var ah=10;for(var aa=0;aa<ag;aa++){if(ac[aa][0]==af&&ac[aa][1]==W){Y=false}Z.push(ac[aa])}if(Y){Z.push([af,W])}var ab=Z;var X="";var ad=ab.length;var aa=0;if(ad>ah){aa=1}var i=aa;if(ad>1){C("#ul_list7").html("");M=true}var ae="";for(;aa<ad;aa++){if(aa>i){X+=","}X+=ab[aa][0]+"#"+ab[aa][1];if(M&&B){ae+='<li class="ac_even" onmouseover="$.stationFor12306.city_shiftSelectInLi(this);" onclick="$.stationFor12306.li_click(this);"   title="'+ab[aa][0]+'" data="'+ab[aa][1]+'">'+ab[aa][0]+"</li>"}}if(M&&B){C("#ul_list7").html(ae)}C.ht_setcookie("_city_name_save_station",X,365*24*60*60)},li_click:function(i){I.val(C(i).text());curObjCode.val(C(i).attr("data"));if(B){C.stationFor12306.setStationInCookies(C(i).text(),C(i).attr("data"))}C("#form_cities2").css("display","none");m=-1;y=0;C.stationFor12306.setStationStyle();if(L){C.stationFor12306.LoadJS(C(i).attr("data"))}if(J){J(I,curObjCode)}},init:function(ac,ad){if(typeof(ad)!="undefined"){if(typeof(ad._init_input)!="undefined"){h=ad._init_input}if(typeof(ad._top_4_initInput)!="undefined"){n=ad._top_4_initInput}if(typeof(ad.confirmCallBack)!="undefined"){J=ad.confirmCallBack}if(typeof(ad._selected_class)!="undefined"){r=ad._selected_class}if(typeof(ad._unselected_class)!="undefined"){l=ad._unselected_class}if(typeof(ad._12306_openFavorite)!="undefined"){B=ad._12306_openFavorite}if(typeof(ad.position)!="undefined"){Q=ad.position}}if(typeof(station_names)!="undefined"){var Z=station_names.split("@");for(var Y=0;Y<Z.length;Y++){var ab=Z[Y];var aa=ab.toString().charAt(0);for(var X in F){if(aa==F[X]){c[X].push(ab.split("|"))}}if(ab.length>0){ab=ab.split("|");if(O!=""&&ab[2]==O){favcity=ab;w.unshift(ab);if(Y>6){w.push(ab)}}else{w.push(ab)}}}f=c[0].concat(c[1]).concat(c[2]).concat(c[3]).concat(c[4]);e=c[5].concat(c[6]).concat(c[7]).concat(c[8]).concat(c[9]);d=c[10].concat(c[11]).concat(c[12]).concat(c[13]).concat(c[14]);b=c[15].concat(c[16]).concat(c[17]).concat(c[18]).concat(c[19]);V=c[20].concat(c[21]).concat(c[22]).concat(c[23]).concat(c[24]).concat(c[25]);P[0]=[c[0],c[1],c[2],c[3],c[4]];P[1]=[c[5],c[6],c[7],c[8],c[9]];P[2]=[c[10],c[11],c[12],c[13],c[14]];P[3]=[c[15],c[16],c[17],c[18],c[19]];P[4]=[c[20],c[22],c[23],c[24],c[25]];for(var Y=0;Y<w.length;Y++){w[Y].push(Y)}}if(typeof(favorite_names)!="undefined"){var W=favorite_names.split("@");for(var Y=0;Y<W.length;Y++){var ab=W[Y];if(ab.length>0){ab=ab.split("|");D.push(ab)}}for(var Y=0;Y<D.length;Y++){D[Y].push(Y)}}E=C.stationFor12306.filterCity("");C.stationFor12306.city_showlist(0);C.stationFor12306.showAllCity();a=false;C.stationFor12306.fixDivBugInIE6(C("#form_cities"));C.stationFor12306.fixDivBugInIE6(C("#form_cities2"));if(ac&&ac.length>0){C.each(ac,function(k,i){C.stationFor12306.bindEvent(i)})}C("#form_cities").mousedown(function(){g=true}).mouseup(function(){g=false});C("#form_cities2").mousedown(function(){H=true}).mouseup(function(){H=false})}}})(jQuery);
(function(){$.stopStation=function(a){var b=this;b.init=function(){b.options=$.extend({},$.stopStation.defaultOptions,a);if(null==b.options.url||null==b.options.getSearchDate){throw"error options,url can not be null"}b.options.mouseOnPanel=0;if(!$("#"+b.options.showDivId)[0]){var d=[];var c=-1;d[++c]='<div class="station" style="display:none;" id="'+b.options.showDivId+'"><b></b>';d[++c]='<div class="station-info" id="'+b.options.showTitleId+'"></div>';d[++c]='<div class="station-hd"><span class="zx">站序</span><span class="zm">站名</span><span class="dzsj">到站时间</span>';d[++c]='<span class="cfsj">出发时间</span><span class="tlsj">停留时间</span>';d[++c]='<a id="_stopStation_close_id" class="close" title="关闭" href="javascript:" </a></div>';d[++c]='<div class="station-bd"><table><tbody id="'+b.options.showTableId+'"></tbody></table></div></div>';$(d.join("")).appendTo($("body:eq(0)"));$("#_stopStation_close_id").on("click",b.close)}$("#"+b.options.showDivId).css("z-index","20001");if(b.options.mouseOutClose){$("#"+b.options.showDivId).on("mouseenter",function(e){b.options.mouseOnPanel=1}).on("mouseleave",function(){b.options.mouseOnPanel=0;$("#"+b.options.showDivId).hide().appendTo($("body:eq(0)"));$("#"+b.options.showTableId).html("")})}};b.close=function(){$("#"+$.stopStation.defaultOptions.showDivId).closest("tr").removeAttr("style");$("#"+$.stopStation.defaultOptions.showDivId).removeAttr("style");b.options.mouseOnPanel=0;$("#"+$.stopStation.defaultOptions.showDivId).hide().appendTo($("body:eq(0)"));$("#"+$.stopStation.defaultOptions.showTableId).html("")};b.open=function(f,j,h,e,i,c){$("#"+$.stopStation.defaultOptions.showDivId).attr("style","z-index:20001");if(a.timer){clearTimeout(a.timer)}var g=a.getSearchDate();if(i&&""!=i&&null!=i){var d=formatDate(i);if("-"!=d){g=formatDate(i)}else{g=a.getSearchDate()}}else{g=a.getSearchDate()}$.ajax({url:a.url,type:"get",isTakeParam:false,beforeSend:function(k){k.setRequestHeader("If-Modified-Since","0");k.setRequestHeader("Cache-Control","no-cache")},data:{train_no:j,from_station_telecode:h,to_station_telecode:e,depart_date:g},success:function(p){var t=p.data.data;if(t&&t.length>0){var r=[];var u=-1;for(var q=0;q<t.length;q++){var l=t[q];if(q==0){var n=null;n=l.train_class_name;var s=l.service_type;if("0"==s){c="无空调"}else{c="有空调"}if(!n){n="&nbsp;&nbsp;"}$("#"+$.stopStation.defaultOptions.showTitleId).html('<span class="item1">'+l.station_train_code+'次      </span><span class="item2">'+l.start_station_name+"<em>--></em>"+l.end_station_name+'</span><span class="item3">'+n+'</span><span class="item4">'+c+"</span>").find("span").css("color","#333")}var m="";if(!l.isEnabled){m=" style='color: #999;' "}r[++u]='<tr><td width="50" class="tc" '+m+">"+l.station_no+"</td>";r[++u]='<td width="75" '+m+">"+l.station_name+"</td>";r[++u]='<td width="75" '+m+">"+l.arrive_time+"</td>";r[++u]='<td width="75" '+m+">"+l.start_time+"</td>";r[++u]="<td "+m+">"+l.stopover_time+"</td></tr>"}$("#"+$.stopStation.defaultOptions.showTableId).html(r.join(""));var o=$("#"+$.stopStation.defaultOptions.appendTo+f);$("#"+$.stopStation.defaultOptions.showDivId).appendTo(o).show();$(".ticket-info").filter("div").attr("style","");o[0].style["z-index"]=19999;if(!(navigator.appVersion.indexOf("MSIE 6")>-1)){}else{}}}})};b.init();myStopStation=b;return b};$.fn.stopStation=function(){return(new $.stopStation(Array.prototype.slice.call(arguments)[0]))};$.stopStation.defaultOptions={url:null,mouseOutClose:false,showDivId:"train_div_",showTableId:"train_table_",showTitleId:"train_span_",appendTo:"train_num_",getSearchDate:null}})();var myStopStation=function(){};var formatDate=function(b){if(b&&(b.length==8)){var c=b.substring(0,4);var d=b.substring(4,6);var a=b.substring(6,8);return c+"-"+d+"-"+a}else{return"-"}};
var checkusermdId;var showTrainStop;var hideTrainStop;var isInitQueryInput=false;var isInitStationDiv=false;var isInitJsrenderTemplate=false;var isInitDateRange=false;var tickets_info;var location_code;var md5Str;var leftTicketStr;var isAsync;refreshImg=function(d,b,a){var g="img-check";if("undefined"==typeof(a)){a="img_rand_code"}else{g="img-check2"}$("#"+a).attr("src",ctx+"passcodeNew/getPassCodeNew?module="+d+"&rand="+b+"&"+Math.random());var c=$("#"+g).html();$("#"+g).html(c);try{$("#i-ok").hide();if($("#i-ok2")[0]){$("#i-ok2").hide()}$("#randCode").val("");$("#randCode").removeClass("error");if($("#randCode2")[0]){$("#randCode2").val("")}}catch(f){}};var countDown=null;var ischeckAutoSubmitCode=false;var firstShow=1;var endShow=20;var dataNumber=0;var change_dates_arr=[];(function(){var s;var av=null;var bj;var a9;var aM;var bg;var O;var az;var ah=false;var bl=0;var Q;var Y;var k;var b;var g;var aO=new Array();var bi=new Array();var bu=new Array();var t=new Array();var bB=new Array();var aX;var al=new Array();var bo;tickets_info=new Array();var ae=true,be=true,aH=true,ao="starttime";var ad=true;var x=[];var ac=[];var bA=[];var bm;var bf=[];var N="";var bz=null;$(document).ready(function(){$.init_ul4li();bk();u();q();aa();aA();V();ag();clickCheckBoxName();e();bw();Z();au();aK();a1();aL();$("#float").headerFloat();$(window).scroll(function(){if(av!=null&&(!av.isHidden())){$("#floatTable").hide();$(window).scrollTop(s)}});$.stopStation({url:ctx+"czxx/queryByTrainNo",getSearchDate:function(){return $.trim($("#train_date").val())}});T();X();a2();aG();_initGuideShow(1);aE();if("Y"==openRandCodeCheck){$("#randCodeLi").show();$("#randCode").on("keyup",function(bC){bC=bC||window.event;if(bC.keyCode==13){}if($("#randCode").val().length==4&&bz!=$("#randCode").val()){$.ajax({url:ctx+"passcodeNew/checkRandCodeAnsyn",type:"post",data:{randCode:$("#randCode").val(),rand:"sjrand"},async:false,success:function(bD){if(bD.data.result!="1"){$("#randCode_span").removeClass("i-ok")}else{$("#randCode").removeClass("error");$("#randCode_span").addClass("i-ok")}}})}else{if($("#randCode").val().length!=4){$("#randCode").addClass("error");$("#randCode_span").removeClass("i-ok")}}bz=$("#randCode").val()}).on("blur",function(){if($("#randCode").val()==""||$("#randCode").val().length!=4){$("#randCode").addClass("error")}})}});function G(){if(rqChecked.length==0){rqChecked.push($("#train_date").val())}}function bt(){if(!isInitStationDiv){v();isInitStationDiv=true}if(!isInitJsrenderTemplate){aP();isInitJsrenderTemplate=true}}function T(){$("#fromStationText").mouseover(bt);$("#toStationText").mouseover(bt);$("#dc").mouseover(bt);$("#wf").mouseover(bt);$("#dc_label").mouseover(bt);$("#wf_label").mouseover(bt);$("#train_date").mouseover(bt);$("#back_train_date").mouseover(bt);$("#date_range").mouseover(bt)}function a8(bC){f();var bF=bB.length;var bE=new Array();bE.push('<tbody id="queryLeftTable">');for(var bD=0;bD<bC.length;bD++){bE.push('<tr id="ticket_');bE.push(bC[bD].queryLeftNewDTO.train_no);bE.push('" class="');bE.push(bD%2?'">':'bgc">');bE.push('<td colspan="4" width="370">');bE.push('<div class="ticket-info clearfix" id="train_num_');bE.push(bD);bE.push('">');bE.push('<div class="train" id="ticket_');bE.push(bC[bD].queryLeftNewDTO.train_no);bE.push('_train">');bE.push('<div><a title="点击查看停靠站信息" href="javascript:" id="');bE.push(bC[bD].queryLeftNewDTO.train_no);bE.push("_");bE.push(bC[bD].queryLeftNewDTO.from_station_telecode);bE.push("_");bE.push(bC[bD].queryLeftNewDTO.to_station_telecode);if("1"==bC[bD].queryLeftNewDTO.controlled_train_flag||"2"==bC[bD].queryLeftNewDTO.controlled_train_flag){bE.push('" class="number"');bE.push(">")}else{bE.push('" class="number"  onclick="myStopStation.open(\'');bE.push(bD);bE.push("','");bE.push(bC[bD].queryLeftNewDTO.train_no);bE.push("','");bE.push(bC[bD].queryLeftNewDTO.from_station_telecode);bE.push("','");bE.push(bC[bD].queryLeftNewDTO.to_station_telecode);bE.push("','");bE.push(bC[bD].queryLeftNewDTO.start_train_date);bE.push("','");bE.push(bC[bD].queryLeftNewDTO.train_seat_feature);bE.push("');\">")}bE.push(bC[bD].queryLeftNewDTO.station_train_code);bE.push("</a>");if(bC[bD].queryLeftNewDTO.is_support_card!=0&&0==bC[bD].queryLeftNewDTO.controlled_train_flag){bE.push(' <span class="i-card" title="可凭二代身份证直接进出站"></span>')}bE.push("</div>");bE.push('<span id="');bE.push(bC[bD].queryLeftNewDTO.train_no);bE.push("_");bE.push(bC[bD].queryLeftNewDTO.from_station_telecode);bE.push("_");bE.push(bC[bD].queryLeftNewDTO.to_station_telecode);bE.push("_");bE.push(bC[bD].queryLeftNewDTO.station_train_code);bE.push("_");bE.push(bC[bD].queryLeftNewDTO.seat_types);var bG=bh(bC[bD].queryLeftNewDTO.station_train_code);if(bG){bE.push('" class="lookup" onclick="showTicketPrice(this)"><span style="display:none;">查看公布票价</span><b title="查看公布票价"></b></span>')}else{bE.push('" class="lookup"></span>')}bE.push("</div>");bE.push('<div class="cdz">');if(bC[bD].queryLeftNewDTO.from_station_telecode!=null&&bC[bD].queryLeftNewDTO.from_station_telecode==bC[bD].queryLeftNewDTO.start_station_telecode){bE.push('<strong class="start-s">');bE.push(bC[bD].queryLeftNewDTO.from_station_name);bE.push("</strong>")}else{bE.push("<strong>");bE.push(bC[bD].queryLeftNewDTO.from_station_name);bE.push("</strong>")}if(bC[bD].queryLeftNewDTO.to_station_telecode!=null&&bC[bD].queryLeftNewDTO.to_station_telecode==bC[bD].queryLeftNewDTO.end_station_telecode){bE.push('<strong class="end-s">');bE.push(bC[bD].queryLeftNewDTO.to_station_name);bE.push("</strong>")}else{bE.push("<strong>");bE.push(bC[bD].queryLeftNewDTO.to_station_name);bE.push("</strong>")}bE.push("</div>");bE.push('<div class="cds">');if("1"==bC[bD].queryLeftNewDTO.controlled_train_flag||"2"==bC[bD].queryLeftNewDTO.controlled_train_flag){bE.push('<strong class="start-t" style="color:#999;">');bE.push("-----");bE.push("</strong>");bE.push('<strong class="color999">');bE.push("-----");bE.push("</strong>")}else{bE.push('<strong class="start-t">');bE.push(bC[bD].queryLeftNewDTO.start_time);bE.push("</strong>");bE.push('<strong class="color999">');bE.push(bC[bD].queryLeftNewDTO.arrive_time);bE.push("</strong>")}bE.push("</div>");bE.push('<div  class="ls" ');bE.push('id="');bE.push(bC[bD].queryLeftNewDTO.train_no);bE.push('_ls">');if("1"==bC[bD].queryLeftNewDTO.controlled_train_flag||"2"==bC[bD].queryLeftNewDTO.controlled_train_flag){bE.push('<strong class="color999">');bE.push("------");bE.push("</strong>");bE.push('<strong class="color999">');bE.push("------");bE.push("</strong>")}else{bE.push("<strong>");bE.push(bC[bD].queryLeftNewDTO.lishi);bE.push("</strong>");bE.push("<span>");bE.push(changeArriveDate(bC[bD].queryLeftNewDTO.start_time,bC[bD].queryLeftNewDTO.lishi));bE.push("到达</span>")}bE.push("</div>");bE.push("</div>");bE.push("</td>");W(bE,bC[bD].queryLeftNewDTO.swz_price,"SWZ_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"91",bC[bD].queryLeftNewDTO.controlled_train_flag,bG);W(bE,bC[bD].queryLeftNewDTO.tz_price,"TZ_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"P1",bC[bD].queryLeftNewDTO.controlled_train_flag,bG);W(bE,bC[bD].queryLeftNewDTO.zy_price,"ZY_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"M1",bC[bD].queryLeftNewDTO.controlled_train_flag,bG);W(bE,bC[bD].queryLeftNewDTO.ze_price,"ZE_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"O1",bC[bD].queryLeftNewDTO.controlled_train_flag,bG);W(bE,bC[bD].queryLeftNewDTO.gr_price,"GR_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"61",bC[bD].queryLeftNewDTO.controlled_train_flag,bG);W(bE,bC[bD].queryLeftNewDTO.rw_price,"RW_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"41",bC[bD].queryLeftNewDTO.controlled_train_flag,bG);W(bE,bC[bD].queryLeftNewDTO.yw_price,"YW_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"31",bC[bD].queryLeftNewDTO.controlled_train_flag,bG);W(bE,bC[bD].queryLeftNewDTO.rz_price,"RZ_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"21",bC[bD].queryLeftNewDTO.controlled_train_flag,bG);W(bE,bC[bD].queryLeftNewDTO.yz_price,"YZ_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"11",bC[bD].queryLeftNewDTO.controlled_train_flag,bG);if(bC[bD].queryLeftNewDTO.WZ_num!="--"){W(bE,bC[bD].queryLeftNewDTO.wz_price,"WZ_",bC[bD].queryLeftNewDTO.train_no,bC[bD].queryLeftNewDTO.yp_ex,"W1",bC[bD].queryLeftNewDTO.controlled_train_flag,bG)}bE.push(' <td width="46" align="center" id="');bE.push("QT_");bE.push(bC[bD].queryLeftNewDTO.train_no);bE.push('">');bE.push("--");bE.push("</td>");if("1"==bC[bD].queryLeftNewDTO.controlled_train_flag||"2"==bC[bD].queryLeftNewDTO.controlled_train_flag){bE.push('<td align="center" width="80" class="no-br">');bE.push(bC[bD].queryLeftNewDTO.controlled_train_message);bE.push("</td>")}else{if("Y"==bC[bD].queryLeftNewDTO.canWebBuy){bE.push(' <td align="center" width="80" class="no-br"><a href="javascript:" class="btn72" onclick="submitOrderRequest(\'');bE.push(bC[bD].secretStr);bE.push("','");bE.push(bC[bD].queryLeftNewDTO.start_time);bE.push("')\">");bE.push(buttonText());bE.push("</a>");bE.push("</td>")}else{bE.push('<td align="center" width="80" class="no-br">');bE.push(bC[bD].buttonTextInfo);bE.push("</td>")}}bE.push("</tr>");if(bh(bC[bD].queryLeftNewDTO.station_train_code)){bE.push('<tr datatran="'+bC[bD].queryLeftNewDTO.station_train_code+'" id="price_');bE.push(bC[bD].queryLeftNewDTO.train_no);bE.push('" style="display:none;"></tr>')}}bE.push("</tbody>");$("#queryLeftTable").replaceWith(bE.join(""))}function W(bH,bC,bN,bI,bD,bL,bE,bG){bD=bD.replace("F","4").replace("A","6");var bK=bD?bD.indexOf(bL):-1;var bJ=false;if(bK>-1&&(bK%2)==0){bJ=true}if("1"==bE||"2"==bE){bH.push(' <td width="46" align="center" style="cursor: pointer;"  id="');bH.push(bN);bH.push(bI);bH.push('">');bH.push(bC);bH.push("</td>")}else{var bM=bC;var bF="";if("--"!=bM){bC=Number(bM)/10;if(bC<=0){bC="--"}else{if(bC.toString().indexOf(".")<0){bC=bC+".0";bC="&yen;"+bC;bF=" class='yes' "}else{bC="&yen;"+bC;bF=" class='yes' "}}}if(bC&&bC.indexOf("NAN")>=0){bC=""}if(bG){bH.push(' <td width="46" align="center" onclick="showTicketPrice(this)" '+bF+' id="')}else{bH.push(' <td width="46" align="center" '+bF+' id="')}bH.push(bN);bH.push(bI);bH.push('">');if(bJ){bH.push('<div class="sale" title="本席别票价打折"><span style="font-family: Arial,Simsun;">'+bC+'</span><span class="i-mark">折</span></div>')}else{bH.push('<span style="font-family: Arial,Simsun;">'+bC+"</span>")}bH.push("</td>")}}function by(bD,bC){ishaveCheckId=false;for(i=0;i<bD.length;i++){if(bD[i][0]==bC){bD[i][1]=$("#".concat($("#".concat(bC)).attr("for"))).is(":checked");ishaveCheckId=true}}if(!ishaveCheckId){bD[bD.length]=[bC,true]}}function aQ(){aD(bj);aD(a9);aD(aM)}function aD(bC){for(i=0;i<bC.length;i++){if(bC[i][1]){$("#".concat(bC[i][0]).concat("_check")).attr("checked",true)}}}function ar(bD){var bC=new Date();var bE=bD.split("-");bC.setFullYear(parseInt(bE[0]),parseInt(bE[1]-1,10),parseInt(bE[2],10));if(bE.length>=6){bC.setHours(bE[3],bE[4],bE[5])}return bC}Date.prototype.format=function(bD){var bE={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(bD)){bD=bD.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var bC in bE){if(new RegExp("("+bC+")").test(bD)){bD=bD.replace(RegExp.$1,RegExp.$1.length==1?bE[bC]:("00"+bE[bC]).substr((""+bE[bC]).length))}}return bD};$("#train_date").focus(function(){$("#train_date").jcalendar({isSingle:false,startDate:init_minPeriod,endDate:init_maxPeriod,onpicked:function(){if($("#dc").is(":checked")){if(rqChecked.length==0){rqChecked.push(startDate)}var bC=false;if(startDate!=rqChecked[0]){for(var bD=0;bD<rqChecked.length;bD++){if(startDate==rqChecked[bD]){bC=true;rqChecked.splice(bD,1);$("#date-list input[value="+rqChecked[0]+"]").prop("checked",false);rqChecked.splice(0,1,startDate);$("#prior_date span[name="+startDate+"]").remove();break}}if(!bC){$("#date-list input[value="+rqChecked[0]+"]").prop("checked",false);rqChecked.splice(0,1,startDate);$("#date-list input[value="+rqChecked[0]+"]").prop("checked",true)}}}aE();$("#train_date").blur()}})});$("#date_icon_1").click(function(){$("#train_date").focus()});function J(bE,bD){var bC=new Date(Date.parse(bE.replace(/-/g,"/")));bC.setDate(bC.getDate()+bD);return aY(bC)}function aY(bD){var bE=bD.getFullYear();var bG=bD.getMonth()+1;var bF=bD.getDate();var bC=bE+"-"+bG+"-"+bF;return bC}function aw(){var bE=$("#train_date").val();var bD=$("#back_train_date").val();var bC=false;if($("#wf").is(":checked")){if(ar(bE)<=ar(bD)){bC=true}}else{return true}return bC}function aN(){var bF=$.jc_getFromStation();if(bF){var bE=bF.split(",");if(bE&&bE.length==2){$("#fromStationText").val(bE[0]);$("#fromStation").val(bE[1])}}var bD=$.jc_getToStation();if(bD){var bE=bD.split(",");if(bE&&bE.length==2){$("#toStationText").val(bE[0]);$("#toStation").val(bE[1])}}var bG=[];bG=stu_buy_date.split("&");var bC=$.jc_getFromDate();if(bC){if(bC>=bG[0]&&bC<=bG[1]){$("#train_date").val(bC)}}var bH=$.jc_getWfOrDc();if(bH&&"wf"==bH){$("#wf").click();var bI=$.jc_getToDate();if(bI){if(bI>=bG[0]&&bI<=bG[1]){$("#back_train_date").val(bI)}}}else{$("#dc").click()}}function bd(){$("#train_stop").on("mouseover",function(bC){if(checkHover(bC,this)){bl=1}}).on("mouseleave",function(){bl=0;$("#train_stop").hide();$("#train_table_").html("")})}function bk(){fromStation=from_station;fromStationName=from_station_name;toStation=to_station;toStationName=to_station_name;trainDate=trainDate;backTrainDate=backTrainDate;bj=new Array();a9=new Array();aM=new Array()}function a2(){$("#fromStation").val(fromStation);$("#fromStationText").val(fromStationName);$("#toStation").val(toStation);$("#toStationText").val(toStationName);$("#train_date").val(trainDate);if(backTrainDate!=null&&backTrainDate!=""){$("#back_train_date").val(backTrainDate)}if($("#fromStationText").val()==""){$("#fromStationText").val("简拼/全拼/汉字")}if($("#toStationText").val()==""){$("#toStationText").val("简拼/全拼/汉字")}if(page_show_flag==null){aN()}else{if(page_show_flag=="index"){a5()}else{if(page_show_flag=="preStep"){ap()}else{if(page_show_flag=="fcInit"){m()}else{if(page_show_flag=="gcInit"){r()}}}}}}function a5(){if(tour_flag=="wf"){$("#wf").click()}else{if(tour_flag=="dc"){$("#dc").click()}}var bC=[];$("#date_range>ul>li").each(function(){var bD=$(this).children("span:first-child").html();bC.push(bD)});$("#query_ticket").click()}function ap(){$("#fromStationText").removeClass().addClass("inp_selected");$("#toStationText").removeClass().addClass("inp_selected");if(train_tour_flag=="dc"){a0(trainDate);$("#dc").click()}if(train_tour_flag=="wc"){a0(trainDate);$("#wf").click()}if(train_tour_flag=="fc"){a0(backTrainDate);$("#wf").click();$("#wf").attr("disabled","true");$("#dc").attr("disabled","true");$("#change_station").removeClass().addClass("i-change i-change2");$("#change_station").attr("style","");$("#fromStationText").attr("title","返程时不得变更出发地或不能变更到达地");$("#toStationText").attr("title","返程时不得变更出发地或不能变更到达地");$("#toStationText").unbind("focus").unbind("click").attr("readonly","true");$("#fromStationText").unbind("focus").unbind("click").attr("readonly","true");$("#dfc>ul>li:nth-child(2)").children("label:first").removeClass().addClass("color999");$("#dfc>ul>li:nth-child(1)").children("label:first").removeClass().addClass("color999");$("#place_area>ul>li:nth-child(1)").addClass("no-change");$("#place_area>ul>li:nth-child(3)").addClass("no-change");$("#place_area>ul>li:nth-child(4)").addClass("no-change");$("#fromStationText").removeClass().addClass("inp-txt");$("#toStationText").removeClass().addClass("inp-txt");$("#change_station").unbind();$("#train_date").val(trainDate);$("#train_date").attr("readonly","true");$("#train_date").removeClass().addClass("inp-txt");train_date.unload();train_date2.unload();$("#date_area>ul>li:nth-child(1)>span>label").addClass("color999");$("#back_train_date").val(backTrainDate);$("#back_train_date").removeAttr("disabled");$("#date_area>ul>li:nth-child(2)>span>label").removeClass("color999");$("#back_train_date").removeClass().addClass("inp_selected")}if(train_tour_flag=="gc"){a0(trainDate);r()}}function a0(bE){for(var bC=1;bC<=20;bC++){var bD=$("#date_range>ul>li:nth-child("+bC+")").children("span:first-child").text();bD="2013-"+bD;if(bE==bD){$("#date_range>ul>li").removeClass("sel");$("#date_range>ul>li").removeAttr("alt");$("#date_range>ul>li:nth-child("+bC+")").addClass("sel");$("#date_range>ul>li:nth-child("+bC+")").attr("alt","show");$("#date_range>ul>li:nth-child(20)").addClass("end");$("#date_range>ul>li:nth-child("+bC+")").children("span:first-child").removeClass();$("#date_range>ul>li:nth-child("+bC+")").children("span:last-child").removeClass();$("#date_range>ul>li:nth-child("+bC+")").children("span:first-child").addClass("hide");$("#date_range>ul>li:nth-child(1)").children().addClass("first");az=$("#date_range>ul>li:nth-child("+bC+")").children("span:first-child").text();break}}}function r(){$("#fromStationText").attr("title","改签时不得变更出发地或不能变更到达地");$("#toStationText").attr("title","改签时不得变更出发地或不能变更到达地");$("#dc").click();$("#wf").attr("disabled","true");$("#dc").attr("disabled","true");$("#place_area>ul>li:nth-child(1)").addClass("no-change");$("#place_area>ul>li:nth-child(3)").addClass("no-change");$("#place_area>ul>li:nth-child(5)").addClass("no-change");$("#dfc>ul>li:nth-child(1)").children("label:first").removeClass().addClass("color999");$("#dfc>ul>li:nth-child(2)").children("label:first").removeClass().addClass("color999");$("#fromStationText").unbind("focus").unbind("click").attr("readonly","true");$("#toStationText").unbind("focus").unbind("click").attr("readonly","true");$("#fromStationText").removeClass().addClass("inp-txt");$("#toStationText").removeClass().addClass("inp-txt");$("#change_station").unbind();$("#change_station").removeClass().addClass("i-change i-change2");$("#change_station").attr("style","");$("#fromStationText_label").addClass("color999");$("#toStationText_label").addClass("color999")}function m(){$("#fromStationText").attr("title","订返程票时不得变更出发地或不能变更到达地");$("#toStationText").attr("title","订返程票时不得变更出发地或不能变更到达地");a0(backTrainDate);$("#wf").click();$("#dc").attr("disabled","true");$("#wf").attr("disabled","true");$("#place_area>ul>li:nth-child(1)").addClass("no-change");$("#place_area>ul>li:nth-child(3)").addClass("no-change");$("#place_area>ul>li:nth-child(4)").addClass("no-change");$("#dfc>ul>li:nth-child(1)").children("label:first").removeClass().addClass("color999");$("#dfc>ul>li:nth-child(2)").children("label:first").removeClass().addClass("color999");$("#train_date").attr("readonly","true");$("#train_date").addClass("color999");train_date.unload();train_date2.unload();$("#date_area>ul>li:nth-child(1)>span>label").addClass("color999");$("#back_train_date").removeAttr("disabled");$("#date_area>ul>li:nth-child(2)>span>label").removeClass("color999");$("#train_date").removeClass().addClass("inp-txt");$("#back_train_date").removeClass().addClass("inp_selected");$("#fromStationText").unbind("focus").unbind("unfocus").unbind("click").attr("readonly","true");$("#toStationText").unbind("focus").unbind("unfocus").unbind("click").attr("readonly","true");$("#fromStationText").removeClass().addClass("inp-txt");$("#toStationText").removeClass().addClass("inp-txt");$("#change_station").unbind();$("#change_station").removeClass().addClass("i-change i-change2");$("#change_station").attr("style","")}function u(){initPageTitle(3);$("#train_type_btn_all").css("cursor","pointer");$("#start_time_btn_all").css("cursor","pointer");$("#arrive_time_btn_all").css("cursor","pointer");$("#seat_type_btn_all").css("cursor","pointer");$("#from_station_name_all").css("cursor","pointer");$("#to_station_name_all").css("cursor","pointer");$("#change_station").css("cursor","pointer");$("#show_more").css("cursor","pointer");$("#date_normal").css("cursor","pointer");$("#lookup").css("cursor","pointer");$("#s_time").css("cursor","pointer");$("#r_time").css("cursor","pointer");$("#l_s").css("cursor","pointer");$("#other_span_starttime").css("cursor","pointer");$("#other_span_endtime").css("cursor","pointer");$("#other_span_lishi").css("cursor","pointer");$("#date_range>ul>li").children("span:nth-child(1)").css("cursor","pointer");$("#cc_seat_type_btn_all>ul>li").hide();$("#train_date").removeClass().addClass("inp_selected");if($("#fromStationText").val()!=""&&$("#fromStationText").val()!="简拼/全拼/汉字"||$("#toStationText").val()!=""&&$("#toStationText").val()!="简拼/全拼/汉字"){$("#fromStationText").removeClass().addClass("inp_selected");$("#toStationText").removeClass().addClass("inp_selected")}var bC=stu_start_train_date.split("&");var bD=stu_end_tain_date.split("&")}function aW(bD){var bC=("00"+(bD.getMonth()+1)).slice(-2)+"-";bC+=("00"+bD.getDate()).slice(-2)+" 00:00:00";return bC}function V(){$("#train_type_btn_all").click(function(){var bC=true;$("#sear-sel-bd input[name='cc_type']").each(function(){if(!this.checked){bC=false}});if(bC){$("#sear-sel-bd input[name='cc_type']").each(function(){this.checked=false});$("#train_type_btn_all").removeClass().addClass("btn-all")}else{$("#sear-sel-bd input[name='cc_type']").each(function(){if(!this.checked){this.checked=true}});$("#train_type_btn_all").removeClass().addClass("btn-all")}aR()});$("#start_time_btn_all").click(function(){var bC=true;$("#sear-sel-bd input[name='cc_start_time']").each(function(){if(!this.checked){bC=false}});if(bC){$("#sear-sel-bd input[name='cc_start_time']").each(function(){this.checked=false});$("#start_time_btn_all").removeClass().addClass("btn-all")}else{$("#sear-sel-bd input[name='cc_start_time']").each(function(){if(!this.checked){this.checked=true}});$("#start_time_btn_all").removeClass().addClass("btn-all")}aR()});$("#from_station_name_all").click(function(){var bC=true;$("#sear-sel-bd input[name='cc_from_station']").each(function(){if(!this.checked){bC=false}});if(bC){$("#sear-sel-bd input[name='cc_from_station']").each(function(){this.checked=false;by(bj,"cc_from_station_"+$(this).val())});$("#from_station_name_all").removeClass().addClass("btn-all")}else{$("#sear-sel-bd input[name='cc_from_station']").each(function(){if(!this.checked){this.checked=true;by(bj,"cc_from_station_"+$(this).val())}});$("#from_station_name_all").removeClass().addClass("btn-all")}aR()});$("#to_station_name_all").click(function(){var bC=true;$("#sear-sel-bd input[name='cc_to_station']").each(function(){if(!this.checked){bC=false}});if(bC){$("#sear-sel-bd input[name='cc_to_station']").each(function(){this.checked=false;by(a9,"cc_to_station_"+$(this).val())});$("#to_station_name_all").removeClass().addClass("btn-all")}else{$("#sear-sel-bd input[name='cc_to_station']").each(function(){if(!this.checked){this.checked=true;by(a9,"cc_to_station_"+$(this).val())}});$("#to_station_name_all").removeClass().addClass("btn-all")}aR()})}function bw(){$("#change_station").bind("click",function(){var bG=$("#fromStationText").val();var bI=$("#fromStation").val();var bH=$("#toStationText").val();var bC=$("#toStation").val();if((bG!=""&&bG!="简拼/全拼/汉字")&&(bH!=""&&bH!="简拼/全拼/汉字")){$("#fromStationText").val(bH);$("#toStationText").val(bG);$("#fromStation").val(bC);$("#toStation").val(bI);$("#fromStationText").removeClass().addClass("inp_selected");$("#toStationText").removeClass().addClass("inp_selected")}else{Y.checkForm();Y.hideErrors();var bF=Y.errorList;for(var bE=0;bE<bF.length;bE++){var bD=bF[bE];$(bD.element).next().addClass("error")}Y.checkForm()}aJ()})}function aJ(){if($("#fromStationText").val()=="简拼/全拼/汉字"){$.stationFor12306.from_to_station_class_gray($("#fromStationText"))}else{$.stationFor12306.from_to_station_class_plain($("#fromStationText"))}if($("#toStationText").val()=="简拼/全拼/汉字"){$.stationFor12306.from_to_station_class_gray($("#toStationText"))}else{$.stationFor12306.from_to_station_class_plain($("#toStationText"))}}function e(){$("#show_more").click(function(){if(!$("#show_more").hasClass("open")){am();$("#show_more").addClass("open");$("#show_more").attr("title","收缩")}else{document.getElementById("sear-sel-bd").style.height="17px";$("#show_more").removeClass("open");$("#show_more").attr("title","展开")}})}function af(){if($("#sear-sel-bd").height()!=17){am()}}function am(){var bE="17px";var bG=51;var bF=28;var bC=$("#sear-sel-bd input[name='cc_from_station']").length;var bH=$("#sear-sel-bd input[name='cc_to_station']").length;var bD=$("#sear-sel-bd input[name='cc_seat_type']").length;if(bC>7&&bC<=14){bE=(bG+bF)+"px"}else{if(bH>7&&bC<=14){bE=(bG+bF*2)+"px"}else{if(bD>7){bE=(bG+bF)+"px"}else{bE=bG+"px"}}}document.getElementById("sear-sel-bd").style.height=bE;$("#show_more").attr("title","收缩")}function v(){if(train_tour_flag=="fc"||train_tour_flag=="gc"){return}$.stationFor12306.init(["fromStation","toStation"],{_init_input:"简拼/全拼/汉字",_top_4_initInput:"简拼/全拼/汉字或↑↓",_unselected_class:"inpt_unselected",_selected_class:"inp_selected",confirmCallBack:function(bC){bC.removeClass("error")}});$("#fromStation_icon_image").css("cursor","pointer");$("#toStation_icon_image").css("cursor","pointer");$("#fromStationText_label").click(function(){$("#fromStationText").focus()});$("#toStationText_label").click(function(){$("#toStationText").focus()});$("#fromStation_icon_image").click(function(){$("#fromStationText").focus()});$("#toStation_icon_image").click(function(){$("#toStationText").focus()})}function X(){Y=$("#queryLeftForm").validate({rules:{"leftTicketDTO.from_station":{required:true},"leftTicketDTO.to_station":{required:true},"leftTicketDTO.train_date":{required:true},"leftTicketDTO.ticket_type":{required:true},randCode:{required:true}},ignore:"",onsubmit:false,onfocusout:function(){},onkeyup:function(){},onclick:function(){},highlight:function(){},unhighlight:function(){}});ab()}function aT(bC){dhtmlx.alert({title:"提示",ok:messages["button.ok"],text:bC,type:"alert-error",callback:function(){}})}function aB(bD,bJ){var bC=Y.checkForm();Y.hideErrors();if(bC){var bI="";if(!aw()){bI="返程日不得小于出发日";aT(bI);return false}var bG=[];if(bJ){bG=stu_buy_date.split("&")}else{bG=other_buy_date.split("&")}if(bG.length>0){if(bD<bG[0]||bD>bG[1]){bI="您选择的日期不在预售期范围内！";aT(bI);return false}}}else{var bH=Y.errorList;for(var bF=0;bF<bH.length;bF++){var bE=bH[bF];$(bE.element).addClass("error").next().addClass("error")}return false}a6();return true}function a6(){$.jc_setFromStation($("#fromStationText").val(),$("#fromStation").val());$.jc_setToStation($("#toStationText").val(),$("#toStation").val());$.jc_setFromDate($("#train_date").val());$.jc_setToDate($("#back_train_date").val());$.jc_setWfOrDc($("#wf").is(":checked")?"wf":"dc")}function ab(){$("#query_ticket").click(function(bG){bt();if(myStopStation){myStopStation.close()}var bD=$.trim($("#train_date").val());var bC=aB(bD,false);if(!bC){return}var bE={"leftTicketDTO.train_date":bD,"leftTicketDTO.from_station":$("#fromStation").val(),"leftTicketDTO.to_station":$("#toStation").val(),"leftTicketDTO.ticket_type":$("#ticket_type").val(),randCode:$("#randCode").val()};aE();var bF=$("#randCode").val();if("Y"==openRandCodeCheck){if(""==bF){$("#randCode").addClass("error");return false}if(bF.length!=4){$("#randCode").addClass("error");return false}else{if(!/^[a-zA-Z0-9]+$/.test(bF)){$("#randCode").addClass("error");return false}else{$.ajax({url:ctx+"passcodeNew/checkRandCodeAnsyn",type:"post",data:{randCode:bF,rand:"sjrand"},async:true,success:function(bH){if(bH.data.result!="1"){refreshImg("other","sjrand");$("#randCode_span").removeClass("i-ok");$("#randCode").addClass("error");$("#randCode").val("");return false}else{$("#randCode").removeClass("error");bx(bE)}}})}}}else{bx(bE)}})}function bx(bC){$("#cc_seat_type_btn_all>ul>li").css("display","none");$("#filterTicDiv").html("");bp();var bD=dhtmlx.modalbox({targSrc:'<div><img src="'+ctx+'resources/images/loading.gif"></img></div>',callback:function(){}});$.ajax({type:"get",isTakeParam:false,beforeSend:function(bE){bE.setRequestHeader("If-Modified-Since","0");bE.setRequestHeader("Cache-Control","no-cache")},cache:true,url:ctx+"leftTicketPrice/query",data:bC,timeout:10000,error:function(bE,bG,bF){dhtmlx.modalbox.hide(bD)},success:function(bF){dhtmlx.modalbox.hide(bD);refreshImg("other","sjrand");$("#randCode").val("");$("#randCode").removeClass("error");$("#randCode_span").removeClass("i-ok");if(bF.status){if(bF.data.message){aT(bF.data.message);return}if(bF.data==null||bF.data.length==0){$("#sear-sel").hide();$("#sear-result").hide();$("#t-list").hide();$("#no_filter_ticket_fromstation").html($("#fromStationText").val());$("#no_filter_ticket_tostation").html($("#toStationText").val());$("#no_filter_ticket_2").show();$(".content").css("min-height","344px");return}$("#sear-sel").show();$("#sear-result").show();$("#t-list").show();$("#no_filter_ticket_2").hide();var bE="<strong>".concat($("#fromStationText").val()).concat(" --> ").concat($("#toStationText").val()).concat("（").concat(a7($("#train_date").val())).concat('）</strong>共计<strong id="trainum">').concat(bF.data.length).concat("</strong>个车次");$("#sear-result>p").html(bE);aO=bF.data;bc(aO);af();j(aO);aQ();br()}}});aZ()}function q(){$("#date_range>ul>li").each(function(bG){var bE=fullDateArr[bG];var bD=new Date(Date.parse(bE.replace(/-/g,"/")));var bF=$("#date_range>ul>li:nth-child("+(bG+1)+")>span[class=hide]").text().substring(0,5)+C(bD);$("#date_range>ul>li:nth-child("+(bG+1)+")>span[class=hide]").text(bF);dates=$(this).children("span:first-child").html();change_dates_arr.push(dates);dataNumber++});if(index_train_date==null){$("#date_range>ul>li:nth-child(1)").addClass("sel");$("#date_range>ul>li:nth-child(1)").attr("alt","show");$("#date_range>ul>li:nth-child(20)").addClass("end");$("#date_range>ul>li:nth-child(1)").children("span:first-child").removeClass();$("#date_range>ul>li:nth-child(1)").children("span:last-child").removeClass();$("#date_range>ul>li:nth-child(1)").children().addClass("first");$("#date_range>ul>li:nth-child(1)").children("span:first-child").addClass("hide");az=$("#date_range>ul>li:nth-child(1)").children("span:first-child").text();for(var bC=endShow+1;bC<=dataNumber;bC++){$("#date_range>ul>li:nth-child("+bC+")").hide()}}c()}function C(bD){var bG=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];var bF=0;for(var bE=0;bE<bG.length;bE++){if(bD.toString().indexOf(bG[bE])>-1){bF=bE+1;break}}var bC="";switch(bF){case 1:bC=" 周一";break;case 2:bC=" 周二";break;case 3:bC=" 周三";break;case 4:bC=" 周四";break;case 5:bC=" 周五";break;case 6:bC=" 周六";break;case 7:bC=" 周日";break}return bC}function d(){$("#date_range>ul>li").unbind("mouseover");$("#date_range>ul>li").unbind("mouseout");$("#date_range").unbind("mouseleave");$("#date_range>ul>li").unbind("click")}function c(){$("#date_range>ul>li").bind("mouseover",function(){$("#date_range>ul>li").removeClass("sel");$("#date_range>ul>li").removeAttr("alt");$(this).addClass("sel");$(this).attr("alt","show");$("#date_range>ul>li:nth-child("+endShow+")").addClass("end");$(this).children("span:first-child").removeClass();$(this).children("span:last-child").removeClass();$("#date_range>ul>li:nth-child("+firstShow+")").children().addClass("first");$(this).children("span:first-child").addClass("hide")});$("#date_range>ul>li").bind("mouseout",function(){$("#date_range>ul>li").each(function(bC){$(this).children("span:first").removeClass();$("#date_range>ul>li:nth-child("+firstShow+")").children().addClass("first");$(this).children("span:last").addClass("hide")})});$("#date_range").bind("mouseleave",function(){for(var bC=firstShow;bC<=endShow;bC++){var bD=$("#date_range>ul>li:nth-child("+bC+")").children("span:first-child").text();if(az==bD){$("#date_range>ul>li").removeClass("sel");$("#date_range>ul>li").removeAttr("alt");$("#date_range>ul>li:nth-child("+bC+")").addClass("sel");$("#date_range>ul>li:nth-child("+bC+")").attr("alt","show");$("#date_range>ul>li:nth-child("+endShow+")").addClass("end");$("#date_range>ul>li:nth-child("+bC+")").children("span:first-child").removeClass();$("#date_range>ul>li:nth-child("+bC+")").children("span:last-child").removeClass();$("#date_range>ul>li:nth-child("+firstShow+")").children().addClass("first");$("#date_range>ul>li:nth-child("+bC+")").children("span:first-child").addClass("hide");break}}});$("#date_range>ul>li").bind("click",function(){var bD=new Date();var bG="";nowDate=$("#train_date").val();var bH=$(this).children("span:first-child").text();var bC=Number(bH.substring(0,2));var bJ=new Date().getMonth();var bF=bD.getFullYear();if(bJ>bC){bF=bF+1}$("#train_date").val(bF+"-"+bH);trainDate=bF+"-"+bH;bG=trainDate;if(!aw()){$("#back_train_date").val($("#train_date").val())}var bI=aB(bG,false);if(!bI){return}$("#date_range>ul>li").removeClass("sel");$("#date_range>ul>li").removeAttr("alt");$(this).addClass("sel");$(this).attr("alt","show");$("#date_range>ul>li:nth-child(20)").addClass("end");$(this).children("span:first-child").removeClass();$(this).children("span:last-child").removeClass();$("#date_range>ul>li:nth-child(1)").children().addClass("first");$(this).children("span:first-child").addClass("hide");az=$(this).children("span:first-child").text();var bE={"leftTicketDTO.train_date":bG,"leftTicketDTO.from_station":$("#fromStation").val(),"leftTicketDTO.to_station":$("#toStation").val(),randCode:$("#randCode").val()};var bK=$("#randCode").val();if("Y"==openRandCodeCheck){if(""==bK){$("#randCode").addClass("error");return false}if(bK.length!=4){$("#randCode").addClass("error");return false}else{if(!/^[a-zA-Z0-9]+$/.test(bK)){$("#randCode").addClass("error");return false}else{$.ajax({url:ctx+"passcodeNew/checkRandCodeAnsyn",type:"post",data:{randCode:bK,rand:"sjrand"},async:true,success:function(bL){if(bL.data.result!="1"){$("#randCode").addClass("error");$("#randCode").val("");refreshImg("other","sjrand");$("#randCode_span").removeClass("i-ok");return false}else{$("#randCode").removeClass("error");bx(bE)}}})}}}else{bx(bE)}})}function ag(){$("#sear-sel-bd input[name='cc_type']").click(function(){var bC=$("input[name='cc_type']");var bD=$("input[name='cc_type']:checked");if($(this).is(":checked")){if(bC&&bD&&bD.length==bC.length){$("#train_type_btn_all").removeClass().addClass("btn-all")}else{$("#train_type_btn_all").removeClass().addClass("btn-all btn-all-sel")}}else{if(bC&&bD&&bD.length==0){$("#train_type_btn_all").removeClass().addClass("btn-all")}else{$("#train_type_btn_all").removeClass().addClass("btn-all btn-all-sel")}}aR()});$("#sear-sel-bd input[name='cc_start_time']").click(function(){var bC=$("input[name='cc_start_time']");var bD=$("input[name='cc_start_time']:checked");if($(this).is(":checked")){if(bC&&bD&&bD.length==bC.length){$("#start_time_btn_all").removeClass().addClass("btn-all")}else{$("#start_time_btn_all").removeClass().addClass("btn-all btn-all-sel")}}else{if(bC&&bD&&bD.length==0){$("#start_time_btn_all").removeClass().addClass("btn-all")}else{$("#start_time_btn_all").removeClass().addClass("btn-all btn-all-sel")}}aR()});$("#sear-sel-bd input[name='cc_arrive_time']").click(function(){var bC=$("input[name='cc_arrive_time']");var bD=$("input[name='cc_arrive_time']:checked");if($(this).is(":checked")){if(bC&&bD&&bD.length==bC.length){$("#arrive_time_btn_all").removeClass().addClass("btn-all")}else{$("#arrive_time_btn_all").removeClass().addClass("btn-all btn-all-sel")}}else{if(bC&&bD&&bD.length==0){$("#arrive_time_btn_all").removeClass().addClass("btn-all")}else{$("#arrive_time_btn_all").removeClass().addClass("btn-all btn-all-sel")}}aR()});$("#cc_start_time").change(function(){aR()})}function K(bE,bD){if(bD.length==0){return true}for(var bC=0;bC<bD.length;bC++){if(bE.queryLeftNewDTO.station_train_code.substring(0,1)==bD[bC]){return true}if(bD[bC]=="QT"){if(bE.queryLeftNewDTO.station_train_code.substring(0,1)!="G"&&bE.queryLeftNewDTO.station_train_code.substring(0,1)!="D"&&bE.queryLeftNewDTO.station_train_code.substring(0,1)!="C"&&bE.queryLeftNewDTO.station_train_code.substring(0,1)!="T"&&bE.queryLeftNewDTO.station_train_code.substring(0,1)!="K"&&bE.queryLeftNewDTO.station_train_code.substring(0,1)!="Z"){return true}}if(bD[bC]=="G"){if(bE.queryLeftNewDTO.station_train_code.substring(0,1)=="C"||bE.queryLeftNewDTO.station_train_code.substring(0,1)=="G"){return true}}}return false}function bv(bF,bH){if(bH.length==0){return true}for(var bC=0;bC<bH.length;bC++){var bG=(bF.queryLeftNewDTO.start_time.replace(":",""));var bD=Number(bH[bC].substring(0,4));var bE=Number(bH[bC].substring(4,8));if(bG>=bD&&bG<=bE){return true}}return false}function an(bE,bC){if(bC.length==0){return true}for(var bD=0;bD<bC.length;bD++){if(bC[bD]=="SWZ"){if(bE.queryLeftNewDTO.swz_num!="--"&&bE.queryLeftNewDTO.swz_num!="无"){al.push("SWZ");return true}}if(bC[bD]=="TZ"){if(bE.queryLeftNewDTO.tz_num!="--"&&bE.queryLeftNewDTO.tz_num!="无"){al.push("TZ");return true}}if(bC[bD]=="ZY"){if(bE.queryLeftNewDTO.zy_num!="--"&&bE.queryLeftNewDTO.zy_num!="无"){al.push("ZY");return true}}if(bC[bD]=="ZE"){if(bE.queryLeftNewDTO.ze_num!="--"&&bE.queryLeftNewDTO.ze_num!="无"){al.push("ZE");return true}}if(bC[bD]=="GR"){if(bE.queryLeftNewDTO.gr_num!="--"&&bE.queryLeftNewDTO.gr_num!="无"){al.push("GR");return true}}if(bC[bD]=="RW"){if(bE.queryLeftNewDTO.rw_num!="--"&&bE.queryLeftNewDTO.rw_num!="无"){al.push("RW");return true}}if(bC[bD]=="YW"){if(bE.queryLeftNewDTO.yw_num!="--"&&bE.queryLeftNewDTO.yw_num!="无"){al.push("YW");return true}}if(bC[bD]=="RZ"){if(bE.queryLeftNewDTO.rz_num!="--"&&bE.queryLeftNewDTO.rz_num!="无"){al.push("RZ");return true}}if(bC[bD]=="YZ"){if(bE.queryLeftNewDTO.yz_num!="--"&&bE.queryLeftNewDTO.yz_num!="无"){al.push("YZ");return true}}if(bC[bD]=="WZ"){if(bE.queryLeftNewDTO.wz_num!="--"&&bE.queryLeftNewDTO.wz_num!="无"){al.push("WZ");return true}}}return false}function p(bD,bC){if(bC.length==0){return true}for(var bE=0;bE<bC.length;bE++){if(bC[bE]==bD.queryLeftNewDTO.from_station_name){return true}}return false}function a(bC,bD){if(bD.length==0){return true}for(var bE=0;bE<bD.length;bE++){if(bD[bE]==bC.queryLeftNewDTO.to_station_name){return true}}return false}function a4(bD,bC){if(bC.length==0){return true}for(var bE=0;bE<bC.length;bE++){if(bC[bE].toLowerCase()==bD.queryLeftNewDTO.station_train_code.toLowerCase()){return true}}return false}function aS(){var bD=[];var bJ=[];var bF=[];var bH=[];$("#sear-sel-bd input[name='cc_type']").each(function(){if(this.checked==true){bD.push($(this).val())}});bJ.push($("#cc_start_time option:selected").val());$("#sear-sel-bd input[name='cc_from_station']").each(function(){if(this.checked==true){bF.push($(this).val())}});$("#sear-sel-bd input[name='cc_to_station']").each(function(){if(this.checked==true){bH.push($(this).val())}});var bE=aO;var bI=[];if(bD.length>0||bJ.length>0||filteredTrainArriveTime.length>0||bA.length>0||bF.length>0||bH.length>0||Q.getComboText()!=""){for(var bC=0;bC<bE.length;bC++){var bG=bE[bC];if(!K(bG,bD)){continue}if(!bv(bG,bJ)){continue}if(!p(bG,bF)){continue}if(!a(bG,bH)){continue}bI.push(bG)}bE=bI}return bE}function L(bC,bD){if(bD==null||bD==""||bC.length==0||bD.length>bC.length){return false}if(bC.substr(0,bD.length)==bD){return true}else{return false}return true}function S(bC){ac=ccSelected;bA=xbChecked;if(a4(bC,ac)&&an(bC,bA)){return true}else{return false}}function f(){bB=[];bi=aS();bu=h(bi);for(var bC=0;bC<bu.length;bC++){var bD=bu[bC];if(!S(bD)){continue}if(bD.queryLeftNewDTO.canWebBuy=="Y"){bB.push(bD)}}}var bz;function aL(){if(ischeckAutoSubmitCode){$("#randCode2").on("keyup",function(bC){if($("#randCode2").val().length==4&&bz!=$("#randCode2").val()){$.ajax({url:ctx+"passcodeNew/checkRandCodeAnsyn",type:"post",data:{randCode:$("#randCode2").val(),rand:"sjrand"},async:false,success:function(bD){if(bD.data.result!="1"){$("#randCode2").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error2").html("验证码不合法");$("#randCode2").val("");$("#c_error2").addClass("error");$("#i-ok2").css("display","none");$("#c_error2").css("margin-left","15px")}else{$("#randCode2").removeClass("inptxt w100 error").addClass("inptxt w100");$("#i-ok2").css("display","block");$("#c_error2").html("");$("#c_error2").removeClass("error")}}})}else{if($("#randCode2").val().length!=4){$("#randCode2").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error2").html("请输入四位长度验证码");$("#c_error2").addClass("error");$("#i-ok2").css("display","none");$("#c_error2").css("margin-left","15px")}}bz=$("#randCode2").val()})}}function bs(bC){return bm.autoSubmit(bB,passengerChecked,xbChecked,ccSelected)}var P=false;function br(){$("#queryLeftTable").html("");$("#trainum").html("");f();if($("#auto_query").is(":checked")){if(bu.length<0){$("#no_filter_ticket").show();$("#trainum").html("0");P=true}else{if(bB.length>0){$("#no_filter_ticket").hide();if(document.getElementById("autoSubmit").checked){var bD=[];for(var bC=0;bC<passengerChecked.length;bC++){var bJ=false;var bI=passengerChecked[bC];for(var bF=0;bF<bD.length;bF++){var bH=bD[bF];if(bI.passenger_name==bH.passenger_name&&bI.passenger_id_type_code==bH.passenger_id_type_code&&bI.passenger_id_no==bH.passenger_id_no){bJ=true;break}}if(!bJ){bD.push(bI)}}passengerChecked=bD;var bG=bs(true);if(bG[0]==1||bG[0]==2){P=true;aX=bG[1];y();var bE="ADULT";if($("#sf2").is(":checked")){bE="0X00"}$.ajax({type:"post",url:ctx+"confirmPassenger/autoSubmitOrderRequest",data:{secretStr:aX.secretStr,train_date:$("#train_date").val(),tour_flag:"dc",purpose_codes:bE,query_from_station_name:$("#fromStationText").val(),query_to_station_name:$("#toStationText").val(),passengerSelectList:passengerChecked},success:function(bL){if(bL.status){if(bL.data&&undefined!=bL.data.result&&typeof(bL.data.result)!="undefined"){var bK=bL.data.result;location_code=bK.split("#")[0];md5Str=bK.split("#")[1];leftTicketStr=bK.split("#")[2];isAsync=bK.split("#")[3];z();aV(bG);$("#i-ok2").hide();refreshImg("other","sjrand","img_rand_code2");$("#randCode2").val("");$("#c_error2").val("");$("#c_error2").removeClass("error");var bM=dhtmlx.createWin({winId:"autosubmitcheckticketinfo",closeWinId:["back_edit"],okId:"qr_submit",okCallBack:function(){if(isAsync==ticket_submit_order.request_flag.isAsync){I()}else{F()}},checkConfirm:function(){if(!ischeckAutoSubmitCode){return true}randCode=$("#randCode2").val();var bN=true;if(""==randCode){bN=false;$("#randCode2").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error2").html(login_messages.randCodeEmpty).attr("class","error").css("margin-left","60px");$("#randCode2").focus()}else{if(!/^[a-zA-Z0-9]+$/.test(randCode)){bN=false;$("#randCode2").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error2").html(login_messages.randCodeFormat).attr("class","error").css("margin-left","60px");$("#randCode2").focus()}else{if(randCode.length!=4){bN=false;$("#randCode2").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error2").html(login_messages.randCodeLentgh).attr("class","error").css("margin-left","60px");$("#randCode2").focus()}}}$.ajax({url:ctx+"passcodeNew/checkRandCodeAnsyn",type:"post",data:{randCode:randCode,rand:"sjrand"},async:false,success:function(bO){if(bO.data.result!="1"){bN=false;$("#randCode2").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error2").html("验证码不合法");$("#randCode2").val("");$("#c_error2").addClass("error");$("#i-ok2").css("display","none")}else{bN=true;$("#randCode2").removeClass("inptxt w100 error").addClass("inptxt w100");$("#i-ok2").css("display","block");$("#c_error2").html("");$("#c_error2").removeClass("error")}}});if(!bN){refreshImg("other","sjrand","img_rand_code2");$("#randCode2").focus();$("#c_error2").css("margin-left","15px")}return bN}});$(".dhx_modal_cover").css("background-color","#EEEEEE")}}}})}else{P=false;ak()}}else{P=true}}else{P=false;ak()}$("#trainum").html(bu.length);a8(bu)}}else{if(bu.length<0){P=true;$("#no_filter_ticket").show();$("#no_filter_ticket_msg_1").show();$("#no_filter_ticket_msg_2").hide();$("#trainum").html("0");return}else{P=true;$("#trainum").html(bu.length);a8(bu)}}}var E=0;var w;function ak(){var bC;if(rqChecked.length>1){if(E>=rqChecked.length){E=0}bC=rqChecked[E++]}else{bC=$.trim($("#train_date").val())}clearInterval(w);w=window.setInterval(function(){$("#train_date").val(bC);var bD={"leftTicketDTO.train_date":bC,"leftTicketDTO.from_station":$("#fromStation").val(),"leftTicketDTO.to_station":$("#toStation").val(),purpose_codes:"ADULT"};bx(bD)},autoSearchTime)}function aR(){if(aO.length==0){return}var bC=aS();var bD=h(bC);$("#train_stop").appendTo($("body")).hide();$("#queryLeftTable").html("");$("#trainum").html("");if(bD.length>0){$("#no_filter_ticket").hide();$("#trainum").html(bD.length)}else{$("#no_filter_ticket").show();$("#no_filter_ticket_msg_1").show();$("#no_filter_ticket_msg_2").hide();$("#trainum").html("0");return}a8(bD)}function at(bD){var bC=O.createWindow(bD+"_",0,0,660,100);bC.attachObject(bD);bC.clearIcon();bC.denyResize();bC.setModal(true);bC.center();bC.button("park").hide();bC.button("minmax1").hide();bC.hideHeader();return bC}function z(){var bH=new Array();$("#autosubmit_check_ticket_tit").html("");var bF=$("#train_date").val();var bC=C(new Date(Date.parse(bF.replace(/-/g,"/"))));var bD=aX.queryLeftNewDTO.station_train_code;var bM=null;var bN=aX.queryLeftNewDTO.from_station_name;var bG=aX.queryLeftNewDTO.to_station_name;var bI=aX.queryLeftNewDTO.start_time;var bL=aX.queryLeftNewDTO.arrive_time;var bK=function(bP,bR,bO,bT,bQ,bS,bV,bU){this.date=bP;this.week=bR;this.station_train_code=bO;this.train_headers=bT;this.from_station=bQ;this.start_time=bS;this.to_station=bV;this.arrive_time=bU};var bE=new bK(bF,bC,bD,bM,bN,bI,bG,bL);bH.push(bE);var bJ=$("#autoSubTicketTitTemplate").html();$.templates({leftTableTemplate:bJ});$("#autosubmit_check_ticket_tit").html($.render.leftTableTemplate(bH))}function aV(bO){if(w){clearInterval(w)}var bC="";var bD="";var bI="1";var bE="成人票";if($("#sf2").is(":checked")){bI="3";bE="学生票"}tickets_info=new Array();var bP=bO[1];var bH=bO[2];var bG=0;var bF=passengerChecked.length;for(var bJ=0;bJ<bH.length;bJ++){var bL=bP.queryLeftNewDTO[bH[bJ].toLowerCase()+"_num"];if(bL=="--"||bL=="无"){bL=0}else{if(bL=="有"){bL=20}else{bL=Number(bL)}}if(bG>=bF){break}var bM=bH[bJ];bC=aI(bM);bD=bn(bM);for(var bK=0;bK<bL;bK++){if(bG>=bF){break}tickets_info.push(new ay("sdAdd_"+aF(),bC,bD,bI,bE,passengerChecked[bG].passenger_name,passengerChecked[bG].passenger_id_type_code,passengerChecked[bG].passenger_id_type_name,passengerChecked[bG].passenger_id_no,passengerChecked[bG].mobile_no));bG++}}var bN=$("#autoSubCheckTicketInfoTemplate").html();$.templates({leftTableTemplate:bN});$("#autosubmit_check_ticketInfo").html($.render.leftTableTemplate(tickets_info))}function y(){var bE=aX.queryLeftNewDTO.yz_num;var bC=aX.queryLeftNewDTO.rz_num;var bI=aX.queryLeftNewDTO.yw_num;var bG=aX.queryLeftNewDTO.rw_num;var bH=aX.queryLeftNewDTO.gr_num;var bF=aX.queryLeftNewDTO.ze_num;var bK=aX.queryLeftNewDTO.zy_num;var bL=aX.queryLeftNewDTO.tz_num;var bD=aX.queryLeftNewDTO.swz_num;var bJ=aX.queryLeftNewDTO.wz_num;if(bE!="--"&&bE!="无"){bo="YZ";return}if(bF!="--"&&bF!="无"){bo="ZE";return}if(bI!="--"&&bI!="无"){bo="YW";return}if(bK!="--"&&bK!="无"){bo="ZY";return}if(bC!="--"&&bC!="无"){bo="RZ";return}if(bG!="--"&&bG!="无"){bo="RW";return}if(bL!="--"&&bL!="无"){bo="TZ";return}if(bH!="--"&&bH!="无"){bo="GR";return}if(bD!="--"&&bD!="无"){bo="SWZ";return}if(bJ!="--"&&bJ!="无"){bo="WZ";return}}function bn(bD){var bC="";if(bD=="ZY"){bC="一等座"}if(bD=="ZE"){bC="二等座"}if(bD=="SWZ"){bC="商务座"}if(bD=="TZ"){bC="特等座"}if(bD=="YZ"){bC="硬座"}if(bD=="RZ"){bC="软座"}if(bD=="YW"){bC="硬卧"}if(bD=="RW"){bC="软卧"}if(bD=="GR"){bC="高级软卧"}if(bD=="WZ"){bC="无座"}return bC}function aI(bD){var bC="";if(bD=="ZY"){bC="M"}if(bD=="ZE"){bC="O"}if(bD=="SWZ"){bC="9"}if(bD=="TZ"){bC="P"}if(bD=="YZ"){bC="1"}if(bD=="RZ"){bC="2"}if(bD=="YW"){bC="3"}if(bD=="RW"){bC="4"}if(bD=="GR"){bC="6"}if(bD=="WZ"){bC="WZ"}return bC}function ay(bJ,bE,bF,bH,bG,bD,bL,bK,bI,bC){this.only_id=bJ,this.seat_type=bE;this.seat_type_name=bF;this.ticket_type=bH,this.ticket_type_name=bG;this.name=bD;this.id_type=bL;this.id_type_name=bK;this.id_no=bI;this.phone_no=bC;this.toString=function(){return this.name+"_"+this.id_type+"_"+this.id_no+"_"+this.phone_no}}function aF(){if(tickets_info.length<1){return tickets_info.length}else{var bE=0;for(var bD=0;bD<tickets_info.length;bD++){var bC=Number(tickets_info[bD].only_id.split("_")[1]);if(bC>bE){bE=bC}}return bE+1}}function aZ(){bB=[];t=[];al=[];tickets_info.length=[];bi=[];bu=[];aX="";isAsync="";location_code="";md5Str="";leftTicketStr="";bo=""}getpassengerTicketsForAutoSubmit=function(){var bC="";for(var bD=0;bD<tickets_info.length;bD++){var bE=tickets_info[bD].seat_type+",0,"+tickets_info[bD].ticket_type+","+tickets_info[bD].name+","+tickets_info[bD].id_type+","+tickets_info[bD].id_no+","+(tickets_info[bD].phone_no==null?"":tickets_info[bD].phone_no)+",N";bC+=bE+"_"}return bC.substring(0,bC.length-1)};getOldPassengersForAutoSubmit=function(){var bE="";for(var bD=0;bD<passengerChecked.length;bD++){var bC=passengerChecked[bD].passenger_name+","+passengerChecked[bD].passenger_id_type_code+","+passengerChecked[bD].passenger_id_no+","+passengerChecked[bD].passenger_type;bE+=bC+"_"}return bE};function F(){$.ajax({url:ctx+"confirmPassenger/confirmSingle",type:"post",data:{passengerTicketStr:getpassengerTicketsForAutoSubmit(),oldPassengerStr:getOldPassengersForAutoSubmit(),tour_flag:"dc",randCode:$("#randCode").val(),purpose_codes:"ADULT",key_check_isChange:md5Str,train_location:location_code},dataType:"json",async:true,success:function(bC){if(bC.status){if(bC.data.submitStatus){otsRedirect("post",ctx+"payOrder/init?random="+new Date().getTime(),{})}else{b("出票失败!",false,"原因： "+bC.data.errMsg+'<a  id="xg_close_win_id">点击修改</a>',false,"lose");$("#xg_close_win_id").click(function(){bg("transforNotice_id",true);$("#i-ok").css("display","none")})}}else{b("订票失败!",true,"很抱歉！请关闭窗口重新预定车票",true,"lose")}},error:function(bC,bE,bD){b("订票失败!",true,"很抱歉！网络忙，请关闭窗口稍后再试。",true,"lose");return}})}function I(){$.ajax({url:ctx+"confirmPassenger/confirmSingleForQueue",type:"post",data:{passengerTicketStr:getpassengerTicketsForAutoSubmit(),oldPassengerStr:getOldPassengersForAutoSubmit(),randCode:$("#randCode").val(),purpose_codes:"ADULT",key_check_isChange:md5Str,leftTicketStr:leftTicketStr,train_location:location_code},dataType:"json",async:true,success:function(bC){if(bC.status){if(!bC.data.submitStatus){b("出票失败!",false,"原因： "+bC.data.errMsg+'<a id="xg_close_win_id" >点击修改</a>',false,"lose");$("#xg_close_win_id").click(function(){bg("transforNotice_id",true);$("#i-ok").css("display","none")})}else{var bD=new OrderQueueWaitTime("dc",aj,bb);bD.start()}}else{b("订票失败!",true,"很抱歉！请关闭窗口重新预定车票",true,"lose")}},error:function(bC,bE,bD){b("订票失败!",true,"很抱歉！网络忙，请关闭窗口稍后再试。",true,"lose");return}})}function aj(bC,bE,bD){if(bE<=5){b("订单已经提交，系统正在处理中，请稍等。",false,"",false,"work")}else{if(bE>30*60){b("订单已经提交，预计等待时间超过30分钟，请耐心等待。",false,"",false,"queue")}else{b("订单已经提交，最新预估等待时间"+bD+"，请耐心等待。",false,"",false,"queue")}}}function bb(bC,bE,bD){if(bE==-1){$.ajax({url:ctx+"confirmPassenger/resultOrderForDcQueue",data:{orderSequence_no:bD.orderId},type:"POST",dataType:"json",success:function(bF){if(bF.status){if(bF.data.submitStatus){otsRedirect("post",ctx+"/payOrder/init?random="+new Date().getTime(),{})}else{b("下单成功",false,"",false,"win")}}else{b("下单成功。",false,"",false,"win")}},error:function(bF,bH,bG){b("下单成功。",false,"",false,"win")}})}else{a3(bE,bD)}}function a3(bC,bD){if(bC==-1){return}else{if(bC==-2){if(bD.errorcode==0){b("订票失败!",true,"原因： "+bD.msg,false,"lose")}else{b("订票失败!",true,"原因： "+bD.msg,false,"lose")}}else{if(bC==-3){b("哎呀,订票失败!",true,"订单已撤销",false,"lose")}else{window.location.href=ctx+"queryOrder/initNoComplete?random="+new Date().getTime()}}}}function aG(){g=new dhtmlXWindows();g.enableAutoViewport(true);g.setSkin("dhx_terrace");g.setImagePath(ctx+"resources/js/rich/windows/imgs/");bg=function(bG,bF){unLoadGrayBackground();if(g.isWindow(bG+"_")){g.window(bG+"_").setModal(false);g.window(bG+"_").hide()}};b=function(bM,bJ,bG,bF,bI){var bL='<div class="tit">'+(bJ?'<span class="colorC">'+bM+"</span>":bM)+"</div>";var bH="<P>"+bG+"</p>";var bK=bJ?'<p>请点击[<a href="'+ctx+'queryOrder/init"><strong>我的12306</strong></a>]办理其他业务。您也可以点击[<a href="'+ctx+'leftTicket/init"><strong>预订车票</strong></a>]，重新规划您的旅程。</p>':'<P>查看订单处理情况，请点击“<a href="'+ctx+'queryOrder/initNoComplete">未完成订单</a>”</P>';$("#iamge_status_id").removeClass().addClass("icon i-"+bI);if(bF){$("#up-box-hd_id").html("提示<a id='closeTranforDialog_id' href='#nogo'>关闭</a>");bK="";$("#lay-btn_id").html("<a href='#nogo' id='qr_closeTranforDialog_id'  class='btn122s '>确认</a>")}else{$("#up-box-hd_id").html("提示");$("#lay-btn_id").html("")}$("#orderResultInfo_id").html(bL+(bG==""||bG==null||bG=="undefined"||bG==undefined?"":bH)+bK);bC("transforNotice_id");if(bF){$("#closeTranforDialog_id").click(function(){bg("transforNotice_id",true)});$("#qr_closeTranforDialog_id").click(function(){bg("transforNotice_id",true);$("#i-ok").css("display","none")})}};function bC(bJ){bg(bJ,false);if("checkticketinfo_id"==bJ){var bH=ticketInfoForPassengerForm.queryLeftNewDetailDTO;if(bH.to_station_telecode==ticket_submit_order.special_areas.lso||bH.to_station_telecode==ticket_submit_order.special_areas.dao||bH.to_station_telecode==ticket_submit_order.special_areas.ado||bH.to_station_telecode==ticket_submit_order.special_areas.nqo||bH.to_station_telecode==ticket_submit_order.special_areas.tho){if(bD()){$("#notice_1_id").html("1.系统将随机为您申请席位，暂不支持自选席位。");$("#notice_2_id").html("2.根据现行规定，外国人在购买进西藏火车票时，须出示西藏自治区外事办公室或旅游局、商务厅的批准函（电），或者出示中国内地司局级接待单位出具的、已征得自治区上述部门同意的证明信函。台湾同胞赴藏从事旅游、商务活动，须事先向西藏自治区旅游局或商务厅提出申请，购买进藏火车票时须出示有关批准函。");if(bE()){$("#notice_3_id").html("3.按现行规定，学生票购票区间必须与学生证上的乘车区间一致，否则车站将不予换票。")}else{$("#notice_3_id").html("")}}}else{$("#notice_1_id").html("1.系统将随机为您申请席位，暂不支持自选席位。");if(bE()){$("#notice_3_id").html("2.按现行规定，学生票购票区间必须与学生证上的乘车区间一致，否则车站将不予换票。")}else{$("#notice_3_id").html("")}}}var bG=n(bJ);var bF=$(window).width()/2-300;var bI=o()+($(window).height()/2-200);bG.setDimension($("#content_"+bJ).width(),$("#content_"+bJ).height()+10);$(".dhtmlx_window_active").height($("#content_"+bJ).height());$(".dhtmlx_window_active").css({left:bF+"px",top:bI+"px"})}function bE(){for(var bG=0;bG<limit_tickets.length;bG++){var bF=limit_tickets[bG];if(bF.ticket_type==ticket_submit_order.ticket_type.student){return true}}return false}function bD(){for(var bG=0;bG<limit_tickets.length;bG++){var bF=limit_tickets[bG];if((ticketInfoForPassengerForm.tour_flag==ticket_submit_order.tour_flag.fc||ticketInfoForPassengerForm.tour_flag==ticket_submit_order.tour_flag.gc)&&bF.save_status!=""&&(bF.id_type==ticket_submit_order.passenger_card_type.passport||bF.id_type==ticket_submit_order.passenger_card_type.work||bF.id_type==ticket_submit_order.passenger_card_type.taiwan)){return true}else{if((ticketInfoForPassengerForm.tour_flag==ticket_submit_order.tour_flag.wc||ticketInfoForPassengerForm.tour_flag==ticket_submit_order.tour_flag.dc)&&(bF.id_type==ticket_submit_order.passenger_card_type.passport||bF.id_type==ticket_submit_order.passenger_card_type.work||bF.id_type==ticket_submit_order.passenger_card_type.taiwan)){return true}}}return false}}function n(bD){var bC=g.createWindow(bD+"_",0,0,660,100);bC.attachObject(bD);bC.clearIcon();bC.denyResize();bC.setModal(true);bC.center();bC.button("park").hide();bC.button("minmax1").hide();bC.hideHeader();return bC}function ar(bD){var bC=new Date();var bE=bD.split("-");bC.setFullYear(parseInt(bE[0]),parseInt(bE[1]-1,10),parseInt(bE[2],10));if(bE.length>=6){bC.setHours(bE[3],bE[4],bE[5])}return bC}function a7(bC){var bF="",bE="";var bH=bC.replace(/-/g,"");if(bH.substring(4,5)=="0"){bF=bH.substring(5,6)+"月"}else{bF=bH.substring(4,6)+"月"}if(bH.substring(6,7)=="0"){bE=bH.substring(7,8)+"日"}else{bE=bH.substring(6,8)+"日"}var bD=new Date(Date.parse(bC.replace(/-/g,"/")));var bG="日一二三四五六";return bF.concat(bE).concat("&nbsp;&nbsp;").concat("周").concat(bG.charAt(bD.getDay()))}showTicketPrice=function(bI){var bK=$(bI).parent("tr").children("td").children("div").children("div").children("span").attr("id");if(undefined==bK||bK==null||"undefined"==typeof(bK)){bK=$(bI).attr("id")}$("#price_"+bJ).hide();$("#tp-list-price").hide();$("#sleeper-price>span").css("cursor","pointer");var bJ=bK.split("_")[0];var bF=bK.split("_")[1];var bC=bK.split("_")[2];var bH=bK.split("_")[3];var bG=bK.split("_")[4];var bD=$("#WZ_"+bJ).html();var bE=$("#QT_"+bJ).html();if($("#ticket_"+bJ+"_train>span>span").text()=="查看公布票价"){if($("#price_"+bJ).children().length>0){$("#ticket_"+bJ+"_train>span>span").html("收起公布票价");$("#ticket_"+bJ+"_train>span>b").addClass("open");$("#ticket_"+bJ+"_train>span>b").attr("title","收起公布票价");$("#price_"+bJ).show();return}if($("#ticket_"+bJ).attr("class")=="bgc"){$("#price_"+bJ).addClass("bgc")}$.ajax({type:"get",isTakeParam:false,beforeSend:function(bL){bL.setRequestHeader("If-Modified-Since","0");bL.setRequestHeader("Cache-Control","no-cache")},url:ctx+"leftTicketPrice/queryPublicPrice",data:{train_no:bJ,train_code:bH,from_station_telecode:bF,to_station_telecode:bC,seat_types:bG,train_date:train_tour_flag=="fc"?$.trim($("#back_train_date").val()):$.trim($("#train_date").val())},success:function(bL){if(bL.status){$("#ticket_"+bJ+"_train>span>span").html("收起公布票价");$("#ticket_"+bJ+"_train>span>b").addClass("open");$("#ticket_"+bJ+"_train>span>b").attr("title","收起公布票价");$("#price_"+bJ).html($.render.priceTableTemplate(bL.data));$("#price_"+bJ).show()}}})}else{$("#ticket_"+bJ+"_train>span>span").html("查看公布票价");$("#ticket_"+bJ+"_train>span>b").attr("title","查看公布票价");$("#ticket_"+bJ+"_train>span>b").removeClass();$("#price_"+bJ).hide()}};function h(bC){if(ao=="starttime"){return bC.sort(function(bE,bD){var bG=Number(bE.queryLeftNewDTO.start_time.replace(":",""));var bF=Number(bD.queryLeftNewDTO.start_time.replace(":",""));if(bG>bF){return ae?1:-1}else{return ae?-1:1}})}else{if(ao=="arrivedtime"){return bC.sort(function(bE,bD){var bG=Number(bE.queryLeftNewDTO.arrive_time.replace(":",""));var bF=Number(bD.queryLeftNewDTO.arrive_time.replace(":",""));if(bG>bF){return be?1:-1}else{return be?-1:1}})}else{if(ao=="lishi"){return bC.sort(function(bE,bD){var bG=Number(bE.queryLeftNewDTO.lishi.replace(":",""));var bF=Number(bD.queryLeftNewDTO.lishi.replace(":",""));if(bG>bF){return aH?1:-1}else{return aH?-1:1}})}}}return bC}function aA(){$("#s_time").click(function(){if(ae){$("#s_time").removeClass().addClass("b4");if($("#r_time").attr("class")=="b4"){$("#r_time").removeClass().addClass("b2")}else{if($("#r_time").attr("class")=="b3"){$("#r_time").removeClass().addClass("b1")}}if($("#l_s").attr("class")=="b4"){$("#l_s").removeClass().addClass("b2")}else{if($("#l_s").attr("class")=="b3"){$("#l_s").removeClass().addClass("b1")}}ae=false;$("#other_span_starttime").removeClass().addClass("b4");if($("#other_span_endtime").attr("class")=="b4"){$("#other_span_endtime").removeClass().addClass("b2")}else{if($("#other_span_endtime").attr("class")=="b3"){$("#other_span_endtime").removeClass().addClass("b1")}}if($("#other_span_lishi").attr("class")=="b4"){$("#other_span_lishi").removeClass().addClass("b2")}else{if($("#other_span_lishi").attr("class")=="b3"){$("#other_span_lishi").removeClass().addClass("b1")}}}else{$("#s_time").removeClass().addClass("b3");if($("#r_time").attr("class")=="b4"){$("#r_time").removeClass().addClass("b2")}else{if($("#r_time").attr("class")=="b3"){$("#r_time").removeClass().addClass("b1")}}if($("#l_s").attr("class")=="b4"){$("#l_s").removeClass().addClass("b2")}else{if($("#l_s").attr("class")=="b3"){$("#l_s").removeClass().addClass("b1")}}ae=true;$("#other_span_starttime").removeClass().addClass("b3");if($("#other_span_endtime").attr("class")=="b4"){$("#other_span_endtime").removeClass().addClass("b2")}else{if($("#other_span_endtime").attr("class")=="b3"){$("#other_span_endtime").removeClass().addClass("b1")}}if($("#other_span_lishi").attr("class")=="b4"){$("#other_span_lishi").removeClass().addClass("b2")}else{if($("#other_span_lishi").attr("class")=="b3"){$("#other_span_lishi").removeClass().addClass("b1")}}}ao="starttime";aR()});$("#other_span_starttime").click(function(){if(ae){$("#s_time").removeClass().addClass("b4");if($("#r_time").attr("class")=="b4"){$("#r_time").removeClass().addClass("b2")}else{if($("#r_time").attr("class")=="b3"){$("#r_time").removeClass().addClass("b1")}}if($("#l_s").attr("class")=="b4"){$("#l_s").removeClass().addClass("b2")}else{if($("#l_s").attr("class")=="b3"){$("#l_s").removeClass().addClass("b1")}}ae=false;$("#other_span_starttime").removeClass().addClass("b4");if($("#other_span_endtime").attr("class")=="b4"){$("#other_span_endtime").removeClass().addClass("b2")}else{if($("#other_span_endtime").attr("class")=="b3"){$("#other_span_endtime").removeClass().addClass("b1")}}if($("#other_span_lishi").attr("class")=="b4"){$("#other_span_lishi").removeClass().addClass("b2")}else{if($("#other_span_lishi").attr("class")=="b3"){$("#other_span_lishi").removeClass().addClass("b1")}}}else{$("#s_time").removeClass().addClass("b3");if($("#r_time").attr("class")=="b4"){$("#r_time").removeClass().addClass("b2")}else{if($("#r_time").attr("class")=="b3"){$("#r_time").removeClass().addClass("b1")}}if($("#l_s").attr("class")=="b4"){$("#l_s").removeClass().addClass("b2")}else{if($("#l_s").attr("class")=="b3"){$("#l_s").removeClass().addClass("b1")}}ae=true;$("#other_span_starttime").removeClass().addClass("b3");if($("#other_span_endtime").attr("class")=="b4"){$("#other_span_endtime").removeClass().addClass("b2")}else{if($("#other_span_endtime").attr("class")=="b3"){$("#other_span_endtime").removeClass().addClass("b1")}}if($("#other_span_lishi").attr("class")=="b4"){$("#other_span_lishi").removeClass().addClass("b2")}else{if($("#other_span_lishi").attr("class")=="b3"){$("#other_span_lishi").removeClass().addClass("b1")}}}ao="starttime";aR()});$("#r_time").click(function(){if(be){$("#r_time").removeClass().addClass("b4");if($("#s_time").attr("class")=="b4"){$("#s_time").removeClass().addClass("b2")}else{if($("#s_time").attr("class")=="b3"){$("#s_time").removeClass().addClass("b1")}}if($("#l_s").attr("class")=="b4"){$("#l_s").removeClass().addClass("b2")}else{if($("#l_s").attr("class")=="b3"){$("#l_s").removeClass().addClass("b1")}}be=false;$("#other_span_starttime").removeClass().addClass("b4");$("#other_span_endtime").removeClass().addClass("b2");$("#other_span_lishi").removeClass().addClass("b2")}else{$("#r_time").removeClass().addClass("b3");if($("#s_time").attr("class")=="b4"){$("#s_time").removeClass().addClass("b2")}else{if($("#s_time").attr("class")=="b3"){$("#s_time").removeClass().addClass("b1")}}if($("#l_s").attr("class")=="b4"){$("#l_s").removeClass().addClass("b2")}else{if($("#l_s").attr("class")=="b3"){$("#l_s").removeClass().addClass("b1")}}be=true;$("#other_span_endtime").removeClass().addClass("b2");if($("#other_span_starttime").attr("class")=="b4"){$("#other_span_starttime").removeClass().addClass("b2")}else{if($("#other_span_starttime").attr("class")=="b3"){$("#other_span_starttime").removeClass().addClass("b1")}}if($("#other_span_lishi").attr("class")=="b4"){$("#other_span_lishi").removeClass().addClass("b2")}else{if($("#other_span_lishi").attr("class")=="b3"){$("#other_span_lishi").removeClass().addClass("b1")}}}ao="arrivedtime";aR()});$("#other_span_endtime").click(function(){if(be){$("#r_time").removeClass().addClass("b4");if($("#s_time").attr("class")=="b4"){$("#s_time").removeClass().addClass("b2")}else{if($("#s_time").attr("class")=="b3"){$("#s_time").removeClass().addClass("b1")}}if($("#l_s").attr("class")=="b4"){$("#l_s").removeClass().addClass("b2")}else{if($("#l_s").attr("class")=="b3"){$("#l_s").removeClass().addClass("b1")}}be=false;$("#other_span_endtime").removeClass().addClass("b4");if($("#other_span_starttime").attr("class")=="b4"){$("#other_span_starttime").removeClass().addClass("b2")}else{if($("#other_span_starttime").attr("class")=="b3"){$("#other_span_starttime").removeClass().addClass("b1")}}if($("#other_span_lishi").attr("class")=="b4"){$("#other_span_lishi").removeClass().addClass("b2")}else{if($("#other_span_lishi").attr("class")=="b3"){$("#other_span_lishi").removeClass().addClass("b1")}}}else{$("#r_time").removeClass().addClass("b3");if($("#s_time").attr("class")=="b4"){$("#s_time").removeClass().addClass("b2")}else{if($("#s_time").attr("class")=="b3"){$("#s_time").removeClass().addClass("b1")}}if($("#l_s").attr("class")=="b4"){$("#l_s").removeClass().addClass("b2")}else{if($("#l_s").attr("class")=="b3"){$("#l_s").removeClass().addClass("b1")}}be=true;$("#other_span_endtime").removeClass().addClass("b3");if($("#other_span_starttime").attr("class")=="b4"){$("#other_span_starttime").removeClass().addClass("b2")}else{if($("#other_span_starttime").attr("class")=="b3"){$("#other_span_starttime").removeClass().addClass("b1")}}if($("#other_span_lishi").attr("class")=="b4"){$("#other_span_lishi").removeClass().addClass("b2")}else{if($("#other_span_lishi").attr("class")=="b3"){$("#other_span_lishi").removeClass().addClass("b1")}}}ao="arrivedtime";aR()});$("#l_s").click(function(){if(aH){$("#l_s").removeClass().addClass("b4");if($("#r_time").attr("class")=="b4"){$("#r_time").removeClass().addClass("b2")}else{if($("#r_time").attr("class")=="b3"){$("#r_time").removeClass().addClass("b1")}}if($("#s_time").attr("class")=="b4"){$("#s_time").removeClass().addClass("b2")}else{if($("#s_time").attr("class")=="b3"){$("#s_time").removeClass().addClass("b1")}}aH=false;$("#other_span_lishi").removeClass().addClass("b4");if($("#other_span_endtime").attr("class")=="b4"){$("#other_span_endtime").removeClass().addClass("b2")}else{if($("#other_span_endtime").attr("class")=="b3"){$("#other_span_endtime").removeClass().addClass("b1")}}if($("#other_span_starttime").attr("class")=="b4"){$("#other_span_starttime").removeClass().addClass("b2")}else{if($("#other_span_starttime").attr("class")=="b3"){$("#other_span_starttime").removeClass().addClass("b1")}}}else{$("#l_s").removeClass().addClass("b3");if($("#r_time").attr("class")=="b4"){$("#r_time").removeClass().addClass("b2")}else{if($("#r_time").attr("class")=="b3"){$("#r_time").removeClass().addClass("b1")}}if($("#s_time").attr("class")=="b4"){$("#s_time").removeClass().addClass("b2")}else{if($("#s_time").attr("class")=="b3"){$("#s_time").removeClass().addClass("b1")}}aH=true;$("#other_span_lishi").removeClass().addClass("b3");if($("#other_span_endtime").attr("class")=="b4"){$("#other_span_endtime").removeClass().addClass("b2")}else{if($("#other_span_endtime").attr("class")=="b3"){$("#other_span_endtime").removeClass().addClass("b1")}}if($("#other_span_starttime").attr("class")=="b4"){$("#other_span_starttime").removeClass().addClass("b2")}else{if($("#other_span_starttime").attr("class")=="b3"){$("#other_span_starttime").removeClass().addClass("b1")}}}ao="lishi";aR()});$("#other_span_lishi").click(function(){if(aH){$("#l_s").removeClass().addClass("b4");if($("#r_time").attr("class")=="b4"){$("#r_time").removeClass().addClass("b2")}else{if($("#r_time").attr("class")=="b3"){$("#r_time").removeClass().addClass("b1")}}if($("#s_time").attr("class")=="b4"){$("#s_time").removeClass().addClass("b2")}else{if($("#s_time").attr("class")=="b3"){$("#s_time").removeClass().addClass("b1")}}aH=false;$("#other_span_lishi").removeClass().addClass("b4");if($("#other_span_endtime").attr("class")=="b4"){$("#other_span_endtime").removeClass().addClass("b2")}else{if($("#other_span_endtime").attr("class")=="b3"){$("#other_span_endtime").removeClass().addClass("b1")}}if($("#other_span_starttime").attr("class")=="b4"){$("#other_span_starttime").removeClass().addClass("b2")}else{if($("#other_span_starttime").attr("class")=="b3"){$("#other_span_starttime").removeClass().addClass("b1")}}}else{$("#l_s").removeClass().addClass("b3");if($("#r_time").attr("class")=="b4"){$("#r_time").removeClass().addClass("b2")}else{if($("#r_time").attr("class")=="b3"){$("#r_time").removeClass().addClass("b1")}}if($("#s_time").attr("class")=="b4"){$("#s_time").removeClass().addClass("b2")}else{if($("#s_time").attr("class")=="b3"){$("#s_time").removeClass().addClass("b1")}}aH=true;$("#other_span_lishi").removeClass().addClass("b3");if($("#other_span_endtime").attr("class")=="b4"){$("#other_span_endtime").removeClass().addClass("b2")}else{if($("#other_span_endtime").attr("class")=="b3"){$("#other_span_endtime").removeClass().addClass("b1")}}if($("#other_span_starttime").attr("class")=="b4"){$("#other_span_starttime").removeClass().addClass("b2")}else{if($("#other_span_starttime").attr("class")=="b3"){$("#other_span_starttime").removeClass().addClass("b1")}}}ao="lishi";aR()})}closeTrainStop=function(){over_flag=false;bl=0;$("#train_stop").hide();$("#train_table").html("")};hideTrainStop=function(bC){over_flag=false;if(ah){clearTimeout(ah)}ah=window.setTimeout(function(){if(bl!=1){bl=0;$("#train_stop").hide();$("#train_table").html("")}},130)};checkHover=function(bD,bC){if(getEvent(bD).type=="mouseover"){return !$.contains(bC,getEvent(bD).relatedTarget||getEvent(bD).fromElement)&&!((getEvent(bD).relatedTarget||getEvent(bD).fromElement)===bC)}else{return !$.contains(bC,getEvent(bD).relatedTarget||getEvent(bD).toElement)&&!((getEvent(bD).relatedTarget||getEvent(bD).toElement)===bC)}};getEvent=function(bC){return bC||window.event};checkHover=function(bD,bC){if(getEvent(bD).type=="mouseover"){return !$.contains(bC,getEvent(bD).relatedTarget||getEvent(bD).fromElement)&&!((getEvent(bD).relatedTarget||getEvent(bD).fromElement)===bC)}else{return !$.contains(bC,getEvent(bD).relatedTarget||getEvent(bD).toElement)&&!((getEvent(bD).relatedTarget||getEvent(bD).toElement)===bC)}};getEvent=function(bC){return bC||window.event};function ba(bE,bC){for(var bD=0;bD<bC.length;bD++){if(bC[bD].key==bE){return true}}return false}function bc(bG){var bL=function(bM){this.value=bM};var bH=new Array();var bD=new Array();var bF={};var bC={};$("#cc_from_station_name_all>ul").html("");$("#cc_to_station_name_all>ul").html("");var bE;var bK;var bJ;for(var bI=0;bI<bG.length;bI++){bE=bG[bI].queryLeftNewDTO.from_station_name;bK=bG[bI].queryLeftNewDTO.to_station_name;bJ=bG[bI];if(!bF[bE]){bH.push(new bL(bE));bF[bE]=true}if(!bC[bK]){bD.push(new bL(bK));bC[bK]=true}}$("#to_station_ul").html($.render.toStationNameTableTemplate(bD));$("#from_station_ul").html($.render.stationNameTableTemplate(bH));$("#sear-sel-bd input[name='cc_from_station']").click(function(){by(bj,"cc_from_station_"+$(this).val());var bM=$("input[name='cc_from_station']");var bN=$("input[name='cc_from_station']:checked");if($(this).is(":checked")){if(bM&&bN&&bN.length==bM.length){$("#from_station_name_all").removeClass().addClass("btn-all")}else{$("#from_station_name_all").removeClass().addClass("btn-all btn-all-sel")}}else{if(bM&&bN&&bN.length==0){$("#from_station_name_all").removeClass().addClass("btn-all")}else{$("#from_station_name_all").removeClass().addClass("btn-all btn-all-sel")}}aR()});$("#sear-sel-bd input[name='cc_to_station']").click(function(){by(a9,"cc_to_station_"+$(this).val());var bM=$("input[name='cc_to_station']");var bN=$("input[name='cc_to_station']:checked");if($(this).is(":checked")){if(bM&&bN&&bN.length==bM.length){$("#to_station_name_all").removeClass().addClass("btn-all")}else{$("#to_station_name_all").removeClass().addClass("btn-all btn-all-sel")}}else{if(bM&&bN&&bN.length==0){$("#to_station_name_all").removeClass().addClass("btn-all")}else{$("#to_station_name_all").removeClass().addClass("btn-all btn-all-sel")}}aR()})}submitOrderRequest=function(bD,bC){$.ajax({type:"post",url:ctx+"login/checkUser",data:{},success:function(bE){var bG;checkusermdId=bE.attributes;if(bE.data.flag){if(train_tour_flag=="fc"){bG=$("#back_train_date").val()}else{bG=$("#train_date").val()}if(k=="0X00"){var bF=false;for(i=(studentComPerArr.length-1);i>=0;i=i-2){if(ar(studentComPerArr[i-1])<=ar(bG)&&ar(studentComPerArr[i])>=ar(bG)){bF=true;break}}if(!bF){aT("学生票的乘车时间为每年的暑假6月1日至9月30日、寒假12月1日至3月31日，目前不办理学生票业务。");return}}H(bD,bC)}else{at();$("#floatTable").hide();s=$(window).scrollTop();aq(bD,bC)}}})};function H(bP,bI){var bC="";if($("#dc").is(":checked")){bC="dc"}else{bC="wc"}if(train_tour_flag=="fc"){bC="fc";var bG=bI.split(":");var bE=$("#back_train_date").val()+"-"+bG[0]+"-"+bG[1]+"-00";try{if(roundReferTime){if(ar(roundReferTime)>=ar(bE)){aT("您预订的往程车票到站时间为"+ar(roundReferTime).format("yyyy年MM月dd日 hh时mm分")+"，返回日期不能早于此时间");return}}}catch(bK){}}if(train_tour_flag=="gc"){bC="gc"}var bD=submitForm();var bO=bD.split(":::");var bJ=bO[0].split(",-,")[0];var bM=bO[0].split(",-,")[1];var bH=bO[1].split(",-,")[0];var bL=bO[1].split(",-,")[1];var bN=checkusermdId!=undefined?"&_json_att="+encodeURIComponent(checkusermdId):"";var bF=escape(bJ)+"="+escape(bM)+"&"+bH+"="+bL+"&secretStr="+bP+"&train_date="+$("#train_date").val()+"&back_train_date="+$("#back_train_date").val()+"&tour_flag="+bC+"&purpose_codes="+k+"&query_from_station_name="+$("#fromStationText").val()+"&query_to_station_name="+$("#toStationText").val()+bN;$.ajax({type:"post",url:ctx+"leftTicket/submitOrderRequest",data:bF,success:function(bQ){if(bQ.status){if(train_tour_flag!=null){if(train_tour_flag=="fc"){otsRedirect("post",ctx+"confirmPassenger/initFc",{});return}if(train_tour_flag=="gc"){otsRedirect("post",ctx+"confirmPassenger/initGc",{});return}}if(bC=="dc"){otsRedirect("post",ctx+"confirmPassenger/initDc",{});return}else{otsRedirect("post",ctx+"confirmPassenger/initWc",{})}}}})}var U=$("#fromStation").val();var ax=$("#toStation").val();var M=$.trim($("#train_date").val());N=U+ax+M;$("#add-train").click(function(){var bD=$("#prior_train span").length;var bF=$.trim($("#inp-train").val()).toUpperCase();if(bF.length==0||bF=="请输入"){dhtmlx.alert({title:"输入车次",ok:"确定",text:"请输入车次",type:"alert-error",callback:function(){$("#inp-train").val("");$("#inp-train").focus()}})}else{if(bD<6){var bJ=/^[a-zA-Z0-9]+$/;var bE=/^[0-9]+$/;if(!bJ.test(bF)){dhtmlx.alert({title:"输入车次",ok:"确定",text:"车次格式输入错误！",type:"alert-error",callback:function(){ccInputSelected=true;$("#inp-train").select()}})}else{if(bE.test(bF)&&bF.length>4){dhtmlx.alert({title:"输入车次",ok:"确定",text:"车次格式输入错误！",type:"alert-error",callback:function(){ccInputSelected=true;$("#inp-train").select()}})}else{if(bF.length<2){dhtmlx.alert({title:"输入车次",ok:"确定",text:"车次格式输入错误！",type:"alert-error",callback:function(){ccInputSelected=true;$("#inp-train").select()}})}else{var bL=$("#fromStation").val();var bM=$("#toStation").val();var bG=$.trim($("#train_date").val());var bO=bL+bM+bG;var bK={"leftTicketDTO.train_date":bG,"leftTicketDTO.from_station":bL,"leftTicketDTO.to_station":bM,purpose_codes:"ADULT"};if(bO!=N){N=bO;$("#prior_train span:gt(0)").remove();ccSelected=[];var bN=[];$.ajax({type:"get",async:false,isTakeParam:false,cache:false,beforeSend:function(bP){bP.setRequestHeader("If-Modified-Since","0");bP.setRequestHeader("Cache-Control","no-cache")},url:ctx+"leftTicket/query",data:bK,timeout:10000,success:function(bP){if(bP.status){if(bP.data==null||bP.data.length==0){dhtmlx.alert({title:"错误信息",ok:"确定",text:"您输入的车次在发到站间不存在，请重新输入！",type:"alert-error",callback:function(){}})}else{var bR=bP.data;for(var bQ=0;bQ<bR.length;bQ++){bN.push(bR[bQ].queryLeftNewDTO.station_train_code.toUpperCase())}bf=bN}}}})}else{if(bf.length==0){$.ajax({type:"get",async:false,isTakeParam:false,cache:false,beforeSend:function(bP){bP.setRequestHeader("If-Modified-Since","0");bP.setRequestHeader("Cache-Control","no-cache")},url:ctx+"leftTicket/query",data:bK,timeout:10000,success:function(bP){if(bP.status){if(bP.data==null||bP.data.length==0){dhtmlx.alert({title:"错误信息",ok:"确定",text:"您输入的车次在发到站间不存在，请重新输入！",type:"alert-error",callback:function(){}})}else{var bR=bP.data;for(var bQ=0;bQ<bR.length;bQ++){bf.push(bR[bQ].queryLeftNewDTO.station_train_code.toUpperCase())}}}}})}}var bC=false;for(var bI=0;bI<bf.length;bI++){if(bF==bf[bI]){bC=true;break}}if(!bC){dhtmlx.alert({title:"错误信息",ok:"确定",text:"您输入的车次在发到站间不存在，请重新输入！",type:"alert-error",callback:function(){}})}else{if($.inArray(bF,ccSelected)<0){var bH="<span class='sel-box w80'>"+bF+"<a class='close' href='javascript:' onclick='$.removeSel(this,\""+bF+"\",4)'></a></span>";$("#prior_train").append(bH);ccSelected.push(bF);$("#inp-train").val("")}else{dhtmlx.alert({title:"输入车次",ok:"确定",text:"此车次已经添加过！",type:"alert-error",callback:function(){ccInputSelected=true;$("#inp-train").select()}})}}}}}}else{dhtmlx.alert({title:"输入车次",ok:"确定",text:"最多添加5个优先车次",type:"alert-error"});$("#inp-train").val("")}}});jQuery.extend({init_ul4li:function(){var bC=[];var bD=0;bC[bD++]='<li><input name="cc_type" value="G" type="checkbox" class="check" /><label for="">GC-高铁/城际</label></li>';bC[bD++]='<li><input name="cc_type" value="D" type="checkbox" class="check" /><label for="">D-动车</label></li>';bC[bD++]='<li><input name="cc_type" value="Z" type="checkbox" class="check" /><label for="">Z-直达</label></li>';bC[bD++]='<li><input name="cc_type" value="T" type="checkbox" class="check" /><label for="">T-特快</label></li>';bC[bD++]='<li><input name="cc_type" value="K" type="checkbox" class="check" /><label for="">K-快速</label></li>';bC[bD++]='<li><input name="cc_type" value="QT" type="checkbox" class="check" /><label for="">其他</label></li>';$("#_ul_station_train_code").html(bC.join(""));$("#startendtime").html('<span class="b3" id="s_time">出发时间</span><br /><span class="b2" id="r_time">到达时间</span>');$("#floatstartendtime").html('<span class="b3" id="other_span_starttime">出发时间</span><br /><span class="b2" id="other_span_endtime">到达时间</span>')},renderPassenger:function(){if(passengerAll){var bG=passengerAll.length;var bF=[];var bC=$("#searchPassenger").val();for(var bE=0;bE<bG;bE++){var bJ=passengerAll[bE];var bI=bJ.passenger_type_name;if(!bI){bI=""}var bH="";var bD="";if($("#sf2").is(":checked")){if(bJ.passenger_type!="3"){bH=" disabled='true' ";bD=" class='color999' "}}if(bC!=""&&bC!="输入乘客姓名"){if(bJ.passenger_name.indexOf(bC)>-1){bF[bE]="<li "+bD+"><input type='checkbox' "+bH+" name='"+bJ.passenger_type+"' class='check' />"+bJ.passenger_name+"("+bI+")("+bJ.passenger_id_no+")</li>"}}else{bF[bE]="<li "+bD+"><input type='checkbox' "+bH+" name='"+bJ.passenger_type+"' class='check' />"+bJ.passenger_name+"("+bI+")("+bJ.passenger_id_no+")</li>"}}$("#buyer-list").html(bF.join(""))}$("#buyer-list input").click(function(){var bL=$("#setion_postion span").length;var bM=this.nextSibling.nodeValue;if(this.checked){if(bL<6){var bK="<span name='"+bM+"' class='sel-box w80'>"+bM+"<a class='close' href='javascript:' onclick='$.removeSel(this,\""+bM+"\",1)'></a></span>";$("#setion_postion").append(bK);$.checkedPasseanger(bM)}else{dhtmlx.alert({title:"添加常用联系人",ok:"确定",text:"最多添加5位联系人",type:"alert-error"});this.checked=false}}else{$.each($("#setion_postion span"),function(bN,bO){if(bM==$(bO).attr("name")){$(bO).remove();$.removePasseanger(bM);return}})}});passengerChecked=[]},reloadPassenger:function(){var bE=dhtmlx.modalbox({targSrc:'<div><img src="'+ctx+'resources/images/loading.gif"></img></div>',callback:function(){}});$.ajax({type:"post",isTakeParam:false,url:ctx+"confirmPassenger/getPassengerDTOs",timeout:10000,error:function(bF,bH,bG){dhtmlx.modalbox.hide(bE)},success:function(bF){dhtmlx.modalbox.hide(bE);if(bF.status){if(bF.data.noLogin=="true"){at();$("#floatTable").hide();s=$(window).scrollTop();aU()}else{passengerAll=bF.data.normal_passengers;$("#sel-buyer").show();$("#sel-seat").hide();$("#sel-date").hide();$("#sel-buyer").css("left",$("#sear-sel").position().left+80);$("#sel-buyer").css("top",$("#sear-sel").position().top+4*28+16);$.renderPassenger()}}}});var bD=$("#setion_postion span");if(bD.length>1){for(var bC=1;bC<bD.length;bC++){bD[bC].remove()}}},showSelectBuyer:function(){if(!passengerAll){$.reloadPassenger()}else{var bC=$("#buyer-list input");for(var bD=0;bD<bC.length;bD++){var bE=$(bC[bD]).attr("name");if($("#sf2").is(":checked")){if(bE!="3"){$(bC[bD]).attr("disabled","true");$(bC[bD]).parent().addClass("color999")}else{$(bC[bD]).removeAttr("disabled");$(bC[bD]).parent().removeClass("color999")}}else{$(bC[bD]).removeAttr("disabled");$(bC[bD]).parent().removeClass("color999")}}$("#sel-buyer").show();$("#sel-seat").hide();$("#sel-date").hide();$("#sel-buyer").css("left",$("#sear-sel").position().left+80);$("#sel-buyer").css("top",$("#sear-sel").position().top+4*28+16)}}});function aa(){$("#show_all_query_result").click(function(){bj=new Array();a9=new Array();aM=new Array();$("#train_type_btn_all").removeClass().addClass("btn-all");$("#start_time_btn_all").removeClass().addClass("btn-all");$("#arrive_time_btn_all").removeClass().addClass("btn-all");$("#seat_type_btn_all").removeClass().addClass("btn-all");$("#from_station_name_all").removeClass().addClass("btn-all");$("#to_station_name_all").removeClass().addClass("btn-all");$("#sear-sel-bd input").each(function(){if(this.checked){this.checked=false}});if(Q){Q.setComboText("")}aR()})}function aP(){var bC=$("#queryPriceTemplate").html().replace("<!--","").replace("-->","");$.templates({priceTableTemplate:bC});var bC=$("#fromStationNameTemplate").html().replace("<!--","").replace("-->","");$.templates({stationNameTableTemplate:bC});var bC=$("#toStationNameTemplate").html().replace("<!--","").replace("-->","");$.templates({toStationNameTableTemplate:bC});var bC=$("#seatTypeTemplate").html().replace("<!--","").replace("-->","");$.templates({seatTypeTemplate:bC});var bC=$("#stationinfoTemplate").html().replace("<!--","").replace("-->","");$.templates({stationinfoTemplate:bC})}function j(bD){dhtmlXCombo_defaultOption.prototype._DrawHeaderButton=function(){};$("#train_combo_box").hide();var bC=[];if(!Q){Q=new dhtmlXCombo("train_combo_box_div","cc",90)}else{Q.setComboText("")}Q.clearAll();Q.addOption(bC);Q.enableFilteringMode(true);Q.attachEvent("onChange",function(){if(Q.getComboText()!=""){if($("#iLcear").is(":hidden")){$("#iLcear").show()}}aR()});if(!$("#iLcear")[0]){$(".dhx_combo_box ").append($('<span style="display: none;" class="i-clear dhx_combo_img_iClear" id="iLcear"></span>'));$("#iLcear").on("click",function(){if(Q){Q.setComboText("");$(this).hide()}})}$(".dhx_combo_input").on("keyup",function(){if($(this).val()==""){$("#iLcear").hide()}else{if($("#iLcear").is(":hidden")){$("#iLcear").show()}}})}function Z(){if(!O){O=new dhtmlXWindows();O.enableAutoViewport(true);O.setSkin("dhx_terrace");O.attachViewportTo("winVP");O.setImagePath(ctx+"resources/js/rich/windows/imgs/")}}function A(){O.window("login").hide();O.window("login").setModal(false)}function at(){if(O.window("login")){O.window("login").setModal(false);O.window("login").hide()}av=O.createWindow("login",0,0,400,350);var bC=$(window).width()/2-140;var bD=o()+($(window).height()/2-205);av.attachObject("relogin");av.setDimension($("#content").width(),$("#content").height()+10);$(".dhtmlx_window_active").height($("#content").height());$(".dhtmlx_window_active").css({left:bC,top:bD});av.bringToTop();O.window("login").clearIcon();O.window("login").denyResize();av.button("park").hide();av.button("minmax1").hide();av.hideHeader();av.setModal(true);$("#relogin_close").click(function(){aC();$("#floatTable").show();A()})}function aC(){D();$("#c_error").html("");$("#c_error").removeClass("error");$("#username").val("");$("#password").val("");$("#randCode").val("");$("#i-ok").hide();refreshImg("other","sjrand");au()}function o(){if("pageYOffset" in window){return window.pageYOffset}else{if(document.compatMode=="BackCompat"){return document.body.scrollTop}else{return document.documentElement.scrollTop}}}function D(){$("#username").removeClass("inptxt w200 error").addClass("inptxt w200");$("#password").removeClass("inptxt w200 error").addClass("inptxt w200");$("#randCode").removeClass("inptxt w100 error").addClass("inptxt w100");$("#randCode2").removeClass("inptxt w100 error").addClass("inptxt w100")}function R(bF){var bC=true;var bD=/^[A-Za-z]{1}([A-Za-z0-9]|[_]){0,29}$/;var bE=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;if(""==bF||bF==null||bF=="用户名／邮箱"||bF=="admin"){bC=false;D();$("#username").removeClass("inptxt w200").addClass("inptxt w200 error");$("#c_error").html(login_messages.userNameEmpty).attr("class","error").css("margin-left","60px");$("#username").focus()}else{if(!bD.test(bF)&&!bE.test(bF)){bC=false;D();$("#username").removeClass("inptxt w200").addClass("inptxt w200 error");$("#c_error").html(login_messages.userNameFormat).attr("class","error").css("margin-left","60px");$("#username").focus()}}if(bC){D();$("#c_error").html("");$("#c_error").removeClass("error")}return bC}function l(bD){var bC=true;if(""==bD||bD==null){bC=false;D();$("#password").removeClass("inptxt w200").addClass("inptxt w200 error");$("#c_error").html(login_messages.passwordEmpty).attr("class","error").css("margin-left","60px");$("#password").focus()}else{if(bD.length<6){bC=false;D();$("#password").removeClass("inptxt w200").addClass("inptxt w200 error");$("#c_error").html(login_messages.passwordLength).attr("class","error").css("margin-left","60px");$("#password").focus()}}if(bC){D();$("#c_error").html("");$("#c_error").removeClass("error")}return bC}function ai(bD){var bC=true;if(""==bD){bC=false;D();$("#randCode").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error").html(login_messages.randCodeEmpty).attr("class","error").css("margin-left","60px");$("#randCode").focus()}else{if(!/^[a-zA-Z0-9]+$/.test(bD)){bC=false;D();$("#randCode").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error").html(login_messages.randCodeFormat).attr("class","error").css("margin-left","60px");$("#randCode").focus()}else{if(bD.length!=4){bC=false;D();$("#randCode").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error").html(login_messages.randCodeLentgh).attr("class","error").css("margin-left","60px");$("#randCode").focus()}else{if(!bq(bD)){bC=false;D();$("#randCode").removeClass("inptxt w100").addClass("inptxt w100 error");$("#c_error").html(login_messages.randCodeError).attr("class","error").css("margin-left","60px");$("#randCode").focus()}}}}if(bC){D();$("#c_error").html("");$("#c_error").removeClass("error")}return bC}function B(){var bE=$.trim($("#username").val());var bD=$.trim($("#password").val());var bC=$.trim($("#randCode").val());if(!R(bE)){return false}if(!l(bD)){return false}if(!ai(bC)){return false}return true}function bq(bD){var bC=true;if(bD!=""&&bD.length==4){$.ajax({url:ctx+"passcodeNew/checkRandCodeAnsyn",type:"post",data:{randCode:bD,rand:"sjrand"},async:false,success:function(bE){if(bE.data=="N"){bC=false;$("#i-ok").css("display","none")}else{bC=true;$("#i-ok").css("display","block");$("#c_error").html("");$("#c_error").removeClass("error");D()}}})}else{bC=false;$("#i-ok").css("display","none")}return bC}function aK(){var bD=false;var bC=false;$("#username").on("keyup",function(){ad=true;var bE=$.trim($("#username").val());bD=R(bE)}).blur(function(){if(ad){var bE=$.trim($("#username").val());bD=R(bE)}});$("#password").blur(function(){if(ad){if(bD){var bE=$.trim($("#password").val());bC=l(bE)}}});$("#randCode").on("keyup",function(){if($.trim($("#password").val())!=""&&$.trim($("#password").val())!=null){if(bC){var bE=$.trim($("#randCode").val());bq(bE)}}}).blur(function(){if($.trim($("#password").val())!=""&&$.trim($("#password").val())!=null){if(bC){var bE=$.trim($("#randCode").val());ai(bE)}}})}function aq(bD,bC){$("#loginSubAsyn").unbind("click");$("#loginSubAsyn").click(function(){var bE=B();if(bE){$("#loginForm").ajaxSubmit({url:ctx+"login/loginUserAsyn?random="+new Date().getTime(),type:"post",dataType:"json",async:false,success:function(bF){if(bF.data.status){if(bF.data.username!=null){A();loginAsyn(bF.data.username);H(bD,bC)}}else{$("#i-ok").hide();refreshImg("other","sjrand");$("#password").val("");$("#randCode").val("");if(bF.data.loginFail!=null){if(bF.data.loginFail=="登录名不存在!"){ad=false;D();$("#username").removeClass("inptxt w200").addClass("inptxt w200 error");$("#c_error").html(bF.data.loginFail).attr("class","error").css("margin-left","60px")}else{if(bF.data.loginFail=="验证码不正确！"&&bF.data.loginFail!="登录名不存在!"){D();$("#randCode").removeClass("inptxt w100").addClass("inptxt w200 error");$("#c_error").html(bF.data.loginFail).attr("class","error").css("margin-left","60px");$("#randCode").focus()}else{if(bF.data.loginFail!="验证码不正确！"&&bF.data.loginFail!="登录名不存在!"){D();$("#password").removeClass("inptxt w200").addClass("inptxt w200 error");$("#c_error").html(bF.data.loginFail).attr("class","error").css("margin-left","60px");$("#password").focus()}}}}}}})}else{at()}})}function aU(){$("#loginSubAsyn").unbind("click");$("#loginSubAsyn").click(function(){var bC=B();if(bC){$("#loginForm").ajaxSubmit({url:ctx+"login/loginUserAsyn?random="+new Date().getTime(),type:"post",dataType:"json",async:false,success:function(bD){if(bD.data.status){if(bD.data.username!=null){A();loginAsyn(bD.data.username)}}else{$("#i-ok").hide();refreshImg("other","sjrand");$("#password").val("");$("#randCode").val("");if(bD.data.loginFail!=null){if(bD.data.loginFail=="登录名不存在!"){ad=false;D();$("#username").removeClass("inptxt w200").addClass("inptxt w200 error");$("#c_error").html(bD.data.loginFail).attr("class","error").css("margin-left","60px")}else{if(bD.data.loginFail=="验证码不正确！"&&bD.data.loginFail!="登录名不存在!"){D();$("#randCode").removeClass("inptxt w100").addClass("inptxt w200 error");$("#c_error").html(bD.data.loginFail).attr("class","error").css("margin-left","60px");$("#randCode").focus()}else{if(bD.data.loginFail!="验证码不正确！"&&bD.data.loginFail!="登录名不存在!"){D();$("#password").removeClass("inptxt w200").addClass("inptxt w200 error");$("#c_error").html(bD.data.loginFail).attr("class","error").css("margin-left","60px");$("#password").focus()}}}}}}})}else{at()}})}function a1(){$("#randCode").keydown(function(bC){bC=bC||window.event;if(bC.keyCode==13||bC.keyCode==9){$("#loginSubAsyn").click()}})}function au(){$("#username").css("color","#333");$("#password").css("color","#333");$("#randCode").css("color","#333");if($("#username").val()==""||$("#username").val()=="用户名／邮箱"||$("#username").val()==null||$("#username").val()=="admin"){$("#username").css("color","#999");$("#username").val("用户名／邮箱");$("#password").val("")}$("#username").focus(function(){var bC=$("#username").val();if(bC=="用户名／邮箱"){$("#username").css("color","#333");$("#username").val("");$("#password").val("")}}).blur(function(){var bC=$("#username").val();if(bC==""){$("#username").css("color","#999");$("#username").val("用户名／邮箱")}})}function aE(){var bC=1;var bI;var bM;var bE;var bH=true;var bG=true;var bK=true;var bN;var bD;var bL=false;bE=dataNumber;var bJ;if(train_tour_flag!=null&&train_tour_flag!=""&&train_tour_flag=="fc"){bJ=jQuery.inArray($("#back_train_date").val().substring(5,10),change_dates_arr)}else{bJ=jQuery.inArray($("#train_date").val().substring(5,10),change_dates_arr)}if(bJ!="-1"){bJ=bJ+1;if(bJ>=firstShow&&bJ<=endShow){bH=false;bG=false;bK=false;bM=endShow+1}else{bN=firstShow;bD=endShow;bL=true;firstShow=bJ;endShow=firstShow+19;if(endShow>dataNumber){endShow=dataNumber;firstShow=endShow-19;bI=firstShow-1;bG=false}else{bI=firstShow-1;bM=endShow+1;if(bI<bC){bH=false}}}if(bH){for(var bF=bC;bF<=bI;bF++){$("#date_range>ul>li:nth-child("+bF+")").hide()}}if(bG){for(var bF=bM;bF<=bE;bF++){$("#date_range>ul>li:nth-child("+bF+")").hide()}}if(bK){for(var bF=firstShow;bF<=endShow;bF++){$("#date_range>ul>li:nth-child("+bF+")").show()}}$("#date_range>ul>li").removeClass("sel");if(bL){$("#date_range>ul>li:nth-child("+bN+")").children("span:first").removeClass();$("#date_range>ul>li:nth-child("+bN+")").children("span:last").removeClass();$("#date_range>ul>li:nth-child("+bD+")").removeClass();$("#date_range>ul>li:nth-child("+firstShow+")").children("span:first").addClass("first");$("#date_range>ul>li:nth-child("+firstShow+")").children("span:last").addClass("first");$("#date_range>ul>li:nth-child("+firstShow+")").children().addClass("first");$("#date_range>ul>li:nth-child("+endShow+")").addClass("end")}$("#date_range>ul>li:nth-child("+bJ+")").addClass("sel");$("#date_range>ul>li:nth-child("+bJ+")").children("span:last-child").removeClass();$("#date_range>ul>li:nth-child("+bJ+")").children("span:first-child").addClass("hide");az=$("#date_range>ul>li:nth-child("+bJ+")").children("span:first-child").text()}}function bp(){$("#query_ticket").unbind("click");$("#query_ticket").removeClass().addClass("btn92s btn-disabled");d();setTimeout(function(){X();c();$("#query_ticket").removeClass().addClass("btn92s ")},5000)}changeArriveDate=function(bD,bC){bD=bD.replace(":","");bC=bC.replace(":","");hour_value=Number(bD.substring(0,2))+Number(bC.substring(0,2));min_value=Number(bD.substring(2,4))+Number(bC.substring(2,4));if(min_value>=60){hour_value=hour_value+1}if(hour_value>=24&&hour_value<48){return"次日"}else{if(hour_value>=48&&hour_value<72){return"两日"}else{if(hour_value>=72){return"三日"}else{return"当日"}}}};changeLiShi=function(bC){if(bC.substring(0,1)=="0"){if(bC.substring(1,2)=="0"){if(bC.substring(3,4)=="0"){bC=bC.substring(4,5)+"分"}else{bC=bC.substring(3,5)+"分"}}else{bC=bC.substring(1,2)+"小时"+bC.substring(3,5)+"分"}}else{if(bC.substring(3,5)=="00"){bC=bC.substring(0,2)+"小时"}else{bC=bC.substring(0,2)+"小时"+bC.substring(3,5)+"分"}}return bC};isNum=function(bC){return parseInt(bC)};buttonText=function(){return"预订"};function bh(bD){if(can_show_public_price&&"Y"!=can_show_public_price){return false}if(bD){var bC=bD.substring(0,1);if("C"==bC||"D"==bC||"G"==bC){return true}}return false}})();
var left_ticket_messages={"leftTicketDTO.from_station":"出发站","leftTicketDTO.to_station":"目的站","leftTicketDTO.train_no":"车次","leftTicketDTO.train_date":"出发日",back_train_date:"返程日"};
jQuery.validator.addMethod("checkLoginUserName",function(f,d){var a=false;var c=/^(13[0-9])|(14[0-9])|(15[0-9])|(18[0-9])|(17[0-9])\d{8}$/;var b=/^[A-Za-z]{1}([A-Za-z0-9]|[_]){0,29}$/;var e=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;if(b.test(f)||e.test(f)||c.test(f)){a=true}return this.optional(d)||a},"wrong username.");jQuery.validator.addMethod("requiredUserName",function(b,a){if("用户名／邮箱／手机号"==b){return false}if(b==null||""==b){return false}return true},"wrong username.");jQuery.validator.addMethod("requiredSchoolName",function(b,a){if("简码／汉字"==b){return false}if(b==null||""==b){return false}return true},"wrong schoolname.");jQuery.validator.addMethod("randCodeRequired",function(b,a){$("#i-ok").css("display","none");return b.length>0},"验证码错误!");jQuery.validator.addMethod("randCodeFormat",function(c,b){$("#i-ok").css("display","none");var a=/^[a-zA-Z0-9]+$/;return this.optional(b)||a.test(c)},"验证码错误!");jQuery.validator.addMethod("randCodeLength",function(b,a){$("#i-ok").css("display","none");return b.length==4},"验证码错误!.");jQuery.validator.addMethod("integrationCheck",function(b,a){var c=/^\d{6}$/;return this.optional(a)||c.test(b)},"wrong integrationpassword");jQuery.validator.addMethod("integrationPwdCheck",function(b,a,c){if($("#"+c[0]).val()==$("#"+c[1]).val()){return true}return false},"两次输入密码不一致!.");jQuery.validator.addMethod("checkRandCode",function(c,b,d){var a=true;if(c&&c.length==4){$.ajax({url:ctx+"passcodeNew/checkRandCodeAnsyn",type:"post",data:{randCode:c,rand:d},async:false,success:function(e){if(e.data=="N"){a=false;$("#i-ok").css("display","none")}else{a=true;$("#i-ok").css("display","block")}}})}else{a=false;$("#i-ok").css("display","none")}return a},"验证码错误!.");jQuery.validator.addMethod("validateUsersName",function(b,a){return this.optional(a)||/^[A-Za-z]{1}([A-Za-z0-9]|[_]){0,29}$/.test(b)},"用户名只能由字母、数字或_组成");jQuery.validator.addMethod("checkWriteSpace",function(c,b){for(var a=0;a<c.length;a++){if(c.charCodeAt(a)==32){return false}}return true},"contain writespace");jQuery.validator.addMethod("validateRandCode",function(b,a){return this.optional(a)||/^[a-zA-Z0-9]+$/.test(b)},"验证码错误!.");jQuery.validator.addMethod("checkPassward",function(c,b,e){var d=true;for(var a=0;a<c.length;a++){if(c.charCodeAt(a)==39||c.charCodeAt(a)==60||c.charCodeAt(a)==62){d=false}if(!d){break}}return this.optional(b)||d},"Passward wrong");function validateSecIdCard(g){var f=0;var a=g;var e={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙",21:"辽宁",22:"吉林",23:"黑龙",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};if(!/^\d{17}(\d|x)$/i.test(a)){return false}a=a.replace(/x$/i,"a");if(e[parseInt(a.substr(0,2))]==null){return false}var c=a.substr(6,4)+"-"+Number(a.substr(10,2))+"-"+Number(a.substr(12,2));var h=new Date(c.replace(/-/g,"/"));if(c!=(h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate())){return false}for(var b=17;b>=0;b--){f+=(Math.pow(2,b)%11)*parseInt(a.charAt(17-b),11)}if(f%11!=1){return false}return true}function validateFirIdCard(g){var f=0;var a;var e={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙",21:"辽宁",22:"吉林",23:"黑龙",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};if(g.length==15){a=idCardUpdate(g)}else{a=g}if(!/^\d{17}(\d|x)$/i.test(a)){return false}a=a.replace(/x$/i,"a");if(e[parseInt(a.substr(0,2))]==null){return false}var c=a.substr(6,4)+"-"+Number(a.substr(10,2))+"-"+Number(a.substr(12,2));var h=new Date(c.replace(/-/g,"/"));if(c!=(h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate())){return false}for(var b=17;b>=0;b--){f+=(Math.pow(2,b)%11)*parseInt(a.charAt(17-b),11)}if(f%11!=1){return false}return true}function idCardUpdate(g){var b;var f=/^(\d){15}$/;if(f.test(g)){var e=0;var a=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var d=new Array("1","0","X","9","8","7","6","5","4","3","2");g=g.substr(0,6)+"19"+g.substr(6,g.length-6);for(var c=0;c<g.length;c++){e+=parseInt(g.substr(c,1))*a[c]}g+=d[e%11];b=g}else{b="#"}return b}jQuery.validator.addMethod("checkBorth",function(e,c){var b=e;if(b==""){return true}else{var a=b.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(a==null){return false}var f=new Date(a[1],a[3]-1,a[4]);return(f.getFullYear()==a[1]&&(f.getMonth()+1)==a[3]&&f.getDate()==a[4])}},"日期格式不合法");jQuery.validator.addMethod("byteRangeLength",function(d,b,e){var c=d.length;for(var a=0;a<d.length;a++){if(d.charCodeAt(a)>127){c++}}return this.optional(b)||(c>=e[0]&&c<=e[1])},"length wrong");jQuery.validator.addMethod("checkNameCharBlank",function(c,b,d){var a=d.split("@");if($("#"+a[1]).val()==""){return true}else{if($("#"+a[0]).val()=="1"||$("#"+a[0]).val()=="2"){return this.optional(b)||/^[a-zA-Z·.．\u3400-\u9FFF]+$/.test(c)}else{if($("#"+a[0]).val()=="B"){if(/^[-]+$/.test(c)){return false}return this.optional(b)||/^[a-z A-Z·.．\u3400-\u9FFF\-]+$/.test(c)}else{if($("#"+a[0]).val()=="H"){if(/^[-]+$/.test(c)){return false}return this.optional(b)||/^[a-z A-Z·。.．\u3400-\u9FFF-]+$/.test(c)}else{return this.optional(b)||/^[a-z A-Z·.．\u3400-\u9FFF]+$/.test(c)}}}}},"wrong name.");jQuery.validator.addMethod("checkIdValidStr",function(c,b){var a=/^[a-zA-Z0-9\_\-\(\)]+$/;return this.optional(b)||(a.test(c))},"wrong id");jQuery.validator.addMethod("isSecIDCard",function(b,a,c){if(!checkIfSecIdCard($(c).val())){return true}return validateSecIdCard(b)},"wrong");function checkIfSecIdCard(a){if(a=="1"){return true}return false}function checkIfFirIdCard(a){if(a=="2"){return true}return false}function checkCardForHKorTW(a){if(a=="C"||a=="G"){return true}return false}jQuery.validator.addMethod("isFirIDCard",function(b,a,c){if(!checkIfFirIdCard($(c).val())){return true}return validateFirIdCard(b)},"wrong");jQuery.validator.addMethod("checkHkongMacao",function(c,b,d){if($(d).val()=="C"){var a=/^[HMhm]{1}([0-9]{10}|[0-9]{8})$/;return this.optional(b)||(a.test(c))}else{return true}},"wrong format.");jQuery.validator.addMethod("checkTaiw",function(c,a,e){if($(e).val()=="G"){var d=/^[0-9]{8}$/;var b=/^[0-9]{10}$/;return this.optional(a)||(d.test(c))||(b.test(c))}else{return true}},"wrong format.");jQuery.validator.addMethod("checkPassport",function(d,b,e){if($(e).val()=="B"){var c=/^[a-zA-Z]{5,17}$/;var a=/^[a-zA-Z0-9]{5,17}$/;return this.optional(b)||(a.test(d))||c.test(d)}else{return true}},"wrong format.");jQuery.validator.addMethod("checkWork",function(c,b,d){if($(d).val()=="H"){var a=/^[a-zA-Z]{3}[0-9]{12}$/;return this.optional(b)||(a.test(c))}else{return true}},"wrong format.");jQuery.validator.addMethod("isMobile",function(d,b){var c=d.length;var a=/^(13[0-9])|(14[0-9])|(15[0-9])|(18[0-9])|(17[0-9])\d{8}$/;return this.optional(b)||(c==11&&a.test(d))},"wrong mobile phone ");jQuery.validator.addMethod("isTelePhone",function(b,a){var c=/(^[0-9]{3,4}\-[0-9]{3,8}$)|(^[0-9]{3,8}$)|(^[0-9]{3,4}\)[0-9]{3,8}$)|(^0{0,1}13[0-9]{9}#)/;return this.optional(a)||(c.test(b))},"wrong telePhone ");jQuery.validator.addMethod("illegalChar",function(c,b,e){var d=true;if(c.indexOf("$")>=0){return false}for(var a=0;a<c.length;a++){if(c.charCodeAt(a)==39||c.charCodeAt(a)==60||c.charCodeAt(a)==62||c.charCodeAt(a)==34||c.charCodeAt(a)==63){d=false}if(!d){break}}return this.optional(b)||d},"Illegal char wrong");jQuery.validator.addMethod("isZipCode",function(c,b){var a=/^[0-9]{6}$/;return this.optional(b)||(a.test(c))},"wrong zipcode");jQuery.validator.addMethod("isEmail",function(c,a){var b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return this.optional(a)||(b.test(trim(c)))},"wrong email");function replaceChar(b){var a=b.value.replace(/['"<> ?]/g,"");b.value=a}function checkNameChar1(a){return/^[a-zA-Z0-9\u3400-\u9FFF]+$/.test(a)}function trim(a){return a.replace(/(^\s*)|(\s*$)/g,"")}function ltrim(a){return a.replace(/(^\s*)/g,"")}function rtrim(a){return a.replace(/(\s*$)/g,"")}jQuery.validator.addMethod("validateName",function(b,a){return this.optional(a)||/^[a-zA-Z\u3400-\u9FFF0-9\_]+$/.test(b)},"wrong username.");jQuery.validator.addMethod("studentRequired",function(b,a,c){if($(c).val()=="3"){return b&&trim(b)!=""}return true},"wrong studentRequired.");jQuery.validator.addMethod("studentStationRequired",function(b,a,c){if($(c).val()=="3"){return b&&trim(b)!="简拼/全拼/汉字"&&trim(b)!=""}return true},"wrong studentStationRequired.");jQuery.validator.addMethod("studentValidateName",function(b,a,c){if($(c).val()=="3"){return this.optional(a)||/^[a-zA-Z\u3400-\u9FFF0-9\_]+$/.test(b)}return true},"wrong username.");jQuery.validator.addMethod("checkStudentName",function(b,a,c){if($(c).val()=="3"){if((!b||trim(b)==""||trim(b)=="简码/汉字")){return false}}return true},"wrong username.");jQuery.validator.addMethod("isQuestionNull",function(b,a,c){if(jQuery.trim(b)!=""){if(jQuery.trim($(c[0]).val())=="customQuestion"&&jQuery.trim($(c[1]).val())==""||jQuery.trim($(c[0]).val())==""){return false}}return true},"you should input the question");jQuery.validator.addMethod("isAnswerNull",function(b,a,c){if((jQuery.trim($(c[0]).val())=="customQuestion"&&jQuery.trim($(c[1]).val())!="")||(jQuery.trim($(c[0]).val())!="")){if(jQuery.trim(b)==""){return false}}return true},"you should input the answer");function checkSex(c,b,a){if(!checkSexByCardId(c,b,a)){if(!confirm("性别与身份证中的性别不符，是否继续?")){return false}else{return true}}else{return true}}function checkSexByCardId(c,e,a){function b(h,i){var g=null;if(i.length==15){g=i.substring(14,15)}else{if(i.length==18){g=i.substring(16,17)}else{return true}}if(g=="x"||g=="X"){g="10"}var f=parseInt(g);var j=f%2;if(j===0&&h==="F"){return true}else{if(j===1&&h==="M"){return true}else{return false}}}var d=$(a).val();if(checkIfSecIdCard($(e).val())&&validateSecIdCard(d)){if(d!==""){return b(c,d)}else{return true}}else{if(checkIfFirIdCard($(e).val())&&validateFirIdCard(d)){if(d!==""){return b(c,d)}else{return true}}else{return true}}}function checkBirdDateByCardId(c,e,b){var a=null;var d=$(b).val();if(checkIfSecIdCard($(e).val())&&d!==""&&validateSecIdCard(d)){a=d.substring(6,14)}else{if(checkIfFirIdCard($(e).val())&&d!==""&&validateFirIdCard(d)){if(d.length==15){a="19"+d.substring(6,12)}else{if(d.length==18){a=d.substring(6,14)}}}else{return true}}if(c!==""){c=c.replace(/-/g,"");if(c!=a){return false}else{return true}}else{return true}}function checkBirdate(c,b,a){if(!checkBirdDateByCardId(c,b,a)){if(!confirm("出生日期与身份证中的出生日期不符，是否继续?")){return false}else{return true}}else{return true}}jQuery.validator.addMethod("checkPwdValidate",function(b,a){return this.optional(a)||/(?![a-z]+$|[0-9]+$|_+$)^[a-zA-Z0-9_]{6,}$/.test(b)},"contain writespace");jQuery.validator.addMethod("checkConfirmPassWard",function(b,a,c){if($(c).val()!=null){return $(c).val()==b}return true},"contain writespace");jQuery.validator.addMethod("IVR_passwd_format",function(b,a){var c=/^[0-9]{6}$/;return this.optional(a)||c.test(b)},"验证码错误!.");jQuery.validator.addMethod("checkStation",function(b,a){if((!b||trim(b)==""||trim(b)=="简拼/全拼/汉字"||trim(b)=="简拼/全拼/汉字或↑↓")){return false}return true},"wrong username.");jQuery.validator.addMethod("checkAnsyUserName",function(e,c,f){var b=f[0];var d=$("#"+f[1]).val();var a=true;$.ajax({url:b+"?user_name="+e,type:"get",async:false,success:function(g,h){if(g.data==true){a=false}else{a=true}},error:function(g,i,h){a=false}});return a},"wrong cardNo");function checkPwdRank(e,a,d){var b=$(e);var c=b.val();if(c.length<=6||new RegExp("^[a-zA-Z]{6,}$").test(c)||new RegExp("^[0-9]{6,}$").test(c)||new RegExp("^[_]{6,}$").test(c)){$("#"+a).attr("title","危险");$("#"+d).html("危险");$("#"+a).removeClass("rank-a");$("#"+a).removeClass("rank-b");$("#"+a).removeClass("rank-c");$("#"+a).addClass("rank-a")}else{if(c.length>6&&new RegExp("[a-zA-Z]").test(c)&&new RegExp("[0-9]").test(c)&&new RegExp("[_]").test(c)){$("#"+a).attr("title","安全");$("#"+d).html("安全");$("#"+a).removeClass("rank-a");$("#"+a).removeClass("rank-b");$("#"+a).removeClass("rank-c");$("#"+a).addClass("rank-c")}else{$("#"+a).attr("title","一般");$("#"+d).html("一般");$("#"+a).removeClass("rank-a");$("#"+a).removeClass("rank-b");$("#"+a).removeClass("rank-c");$("#"+a).addClass("rank-b")}}}Array.prototype.unique=function(){var b={},a=this.length;for(var c=0;c<a;c++){if(typeof b[this[c]]=="undefined"){b[this[c]]=1}}this.length=0;a=0;for(var c in b){this[a++]=c}return this};function checkSearchPwdRank(h,c,g){var e=$(h);var f=e.val();if(f.length<6){$("#"+c).attr("title","危险");$("#"+g).html("危险");$("#"+c).removeClass("rank-a");$("#"+c).removeClass("rank-b");$("#"+c).removeClass("rank-c");$("#"+c).addClass("rank-a")}else{var a=[];for(var b=0;b<6;b++){a.push(f.charAt(b))}a=a.unique();var d=a.length;if(d==1){$("#"+c).attr("title","危险");$("#"+g).html("危险");$("#"+c).removeClass("rank-a");$("#"+c).removeClass("rank-b");$("#"+c).removeClass("rank-c");$("#"+c).addClass("rank-a")}else{if(d>1&&d<5){$("#"+c).attr("title","一般");$("#"+g).html("一般");$("#"+c).removeClass("rank-a");$("#"+c).removeClass("rank-b");$("#"+c).removeClass("rank-c");$("#"+c).addClass("rank-b")}else{$("#"+c).attr("title","安全");$("#"+g).html("安全");$("#"+c).removeClass("rank-a");$("#"+c).removeClass("rank-b");$("#"+c).removeClass("rank-c");$("#"+c).addClass("rank-c")}}}}jQuery.validator.addMethod("checkDetailAddress",function(b,a){return this.optional(a)||/^[0-9a-zA-Z\u3400-\u9FFF\#]+$/.test(b)},"wrong name.");jQuery.validator.addMethod("checkAddressName",function(b,a){if(/^[-]+$/.test(b)){return false}return this.optional(a)||/^[a-z A-Z·.．\u3400-\u9FFF\-]+$/.test(b)||/^[a-zA-Z·.．\u3400-\u9FFF]+$/.test(b)},"wrong name.");jQuery.validator.addMethod("checkAddressSelect",function(b,a){if(""==b){return false}if(b){return true}return this.optional(a)},"wrong name.");
var login_messages={randCodeError:"验证码错误!",randCodeExpired:"验证码失效",randCodeLentgh:"验证码长度为4位!",randCodeFormat:"验证码只能由数字或字母组成!",randCodeEmpty:"验证码不能为空!",userNameEmpty:"登录名必须填写!",userNameFormat:"登录名格式不正确，请重新输入!",passwordEmpty:"密码必须填写,且不少于6位!",passwordLength:"密码长度不能少于6位!",pleaseClickCaptcha:"请点击验证码",pleaseClickLeftCaptcha:"请点击左侧验证码",pleaseClickCaptchaRight:"请点击正确的验证码",pleaseClickBottomCaptcha:"请点击下方验证码",loginError:"当前访问用户过多,请稍候重试!",submitAfterVerify:"提交",pleaseClickSubmitButtonAfterClick:"pleaseClickSubmitButtonAfterClick",leftTicketOrderNoteMessage:'点击"提交"按钮获取验证码',leftTicketOrderClickCallbackNoteMessage:'完成选择后，继续点击下方橙色"提交"按钮提交订单',leftTicketOrderShowCallbackNoteMessage:"按照提示点击选择所有的图片",leftTicketOrderHiddenCallbackNoteMessage:'点击"提交"按钮获取验证码',getCaptchaByClick:"点击获取验证码"};
